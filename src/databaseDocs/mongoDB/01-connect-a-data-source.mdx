### Step 1. Init the PostgreSQL connector

To initialize the PostgreSQL connector, run the following, replacing `<subgraph-name>` with the name of the subgraph
which will contain this connector and its eventual data source:

```bash
ddn connector init mypg --dir <subgraph-name>/connector/mypg --hub-connector hasura/postgres
```

In this command, we're passing a few important values.

**Connector name**

First, we're naming our connector `mypg`, but you can call it whatever makes sense to your business outcome. For
example, if this connector is integrating a database all about users' profiles, it would make sense to name it
`user_profile_connector` so you and your team know which data source this relates to. **Importantly, a data connector
can only connect to a single data source.**

**Directory for the connector**

Second, we're passing the `--dir` flag to tell the CLI to which subgraph this connector belong _and_ that the
configuration files it's generating should be organized in a `connector/mypg` directory. **Note: the name of the
connector and the directory in which the configuration is stored â€” `mypg` in this example â€”Â should match.**

**Connector type**

Additionally, we're calling out another value: `hasura/postrgres`, which is the connector from the
[Connector Hub](https://hasura.io/connectors/postgres).

### Step 2. Modify the connector's published port

By default, all connectors run on `8080`. However, to avoid port collisions, we'll change the connector's published port
to `8081`. In the `docker-compose.mypg.yaml` file, which can be found in the directory you created in the last step,
replace the existing `published` value with:

```yaml
ports:
  - mode: ingress
    target: 8080
    #highlight-start
    published: '8081'
    #highlight-end
    protocol: tcp
```

### Step 3. Include the PostgreSQL connector's compose file

In our main `docker-compose.yaml` in the root of the project, add the following at the top taking care to replace
`<subgraph-name>` with your subgraph:

```yaml
include:
  - path: <subgraph-name>/connector/mypg/docker-compose.mypg.yaml
```

### Step 4. Add the connection URI

Now that our connector has been scaffolded out for us, we need to provide a connection string so that the data source
can be introspected and the boilerplate configuration can be taken care of by the CLI. Below, note that there are a few
caveats to consider before continuing.

:::info Environment-specific caveats

**Local PostgreSQL**

If you're using a local PostgreSQL database â€” such as through [Docker](https://hub.docker.com/_/postgres) â€” you'll need
to use a tool like [ngrok](https://ngrok.com/) to tunnel your database's connection. This will expose the port, most
likely `5432`, on which the database is running and allow Hasura DDN to connect to it.

**Cloud-hosted PostgreSQL**

Alternatively, if you have a cloud-hosted database, as Hasura DDN will need to reach your database, ensure you've
allowlisted `0.0.0.0/0` so that DDN is able to reach it.

:::

Each connector automatically scaffolds out an env file. We can add a key-value pair of `CONNECTION_URI` along with the
connection string itself to this file and our connector will use this to connect to our PostgreSQL database. The file,
after adding the `CONNECTION_URI` should look like this:

```env
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://local-dev.hasura.me:4317
OTEL_SERVICE_NAME=mypg
CONNECTION_URI=<postgres-connection-uri>
```

:::tip o11y via OpenTelemetry

Yes! Connectors ship with OTEL-enabled tracing available, out of the box ðŸŽ‰

:::

### Step 5. Introspect your database

With connector configured, we can now use the CLI to introspect our PostgreSQL database create a source-specific
configuration file for our connector:

```bash
ddn connector introspect --connector ux/connector/mypg/connector.yaml
```

If you look at the `configuration.json` for your connector, you'll see metadata describing your PostgreSQL schema.

:::tip Initialize a Git repository

At this point, we recommend initializing a Git repository. This gives you a fallback point as you begin to iterate on
your project.

:::
