import BaseUrlLink from '@site/src/_databaseDocs/baseLink';

## What's about to happen?

<!-- prettier-ignore -->
Collections and objects in collections in your MongoDB database are exposed to your API via - <BaseUrlLink to="/supergraph-modeling/models" text="models" />.

You can use the CLI to generate an `hml` file which will represent a model, allowing you to easily and declaratively
customize authorization rules, create relationships, or even deprecate certain fields.

:::tip Required

<!-- prettier-ignore -->
- <BaseUrlLink to="/getting-started/prerequisites" text="DDN CLI" />
- A new or existing <BaseUrlLink to="/getting-started/init-supergraph" text="supergraph" />
- A new or existing <BaseUrlLink to="/getting-started/init-subgraph" text="subgraph" />

:::

## Add a model

<!-- prettier-ignore -->
Hasura DDN works by deploying your API as immutable builds, similar to git commits, based on changes to your project's
metadata. This frees you to iteratively and rapidly test incremental changes to your API without causing disruption
to other collaborators or downstream consumers. Before we create a supergraph build, let's first add a <BaseUrlLink to="supergraph-modeling/models/" text="model" /> to our subgraph.

<!-- prettier-ignore -->
Models serve as the link between your data connector and the API Hasura generates. For MongoDB, models typically
correspond to collections and objects in those collections, but you can also create them for <BaseUrlLink to="connectors/mongodb/native-queries/" text="native queries" />

If you look in your `my_subgraph/connector/my_mongo/connector/my_mongo.hml` file, you'll see `object_types` for each
collection and object in your collection in your MongoDB database. For each of these, you can run the following
command to create a model:

```bash
ddn model add --connector-link my_mongo --name <object_type>
```

:::tip Casing matters

When adding a model, it is critical to use the same casing as the `object_type` from your connector's configuration
file.

:::

<details>
  <summary>
    Each time you add a model, you'll see a new named file in the `models` directory of your connector. For example, if we
    ran the previous command on the `movies` type, we'd then see a `Movies.hml` file that contains all the metadata
    Hasura DDN needs to add it to our API. Click here to see an example `hml` file.
  </summary>

```yaml
# Movies.hml
---
kind: ObjectType
version: v1
definition:
  name: MoviesAwards
  fields:
    - name: nominations
      type: Int
    - name: text
      type: String
    - name: wins
      type: Int
  graphql:
    typeName: MySubgraph_MoviesAwards
    inputTypeName: MySubgraph_MoviesAwardsInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_mongo
      dataConnectorObjectType: movies_awards

---
kind: TypePermissions
version: v1
definition:
  typeName: MoviesAwards
  permissions:
    - role: admin
      output:
        allowedFields:
          - nominations
          - text
          - wins

---
kind: ObjectType
version: v1
definition:
  name: MoviesImdb
  fields:
    - name: id
      type: Int
    - name: rating
      type: Double
    - name: votes
      type: Int
  graphql:
    typeName: MySubgraph_MoviesImdb
    inputTypeName: MySubgraph_MoviesImdbInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_mongo
      dataConnectorObjectType: movies_imdb

---
kind: TypePermissions
version: v1
definition:
  typeName: MoviesImdb
  permissions:
    - role: admin
      output:
        allowedFields:
          - id
          - rating
          - votes

---
kind: ObjectType
version: v1
definition:
  name: MoviesTomatoesCritic
  fields:
    - name: meter
      type: Int
    - name: numReviews
      type: Int
    - name: rating
      type: Double
  graphql:
    typeName: MySubgraph_MoviesTomatoesCritic
    inputTypeName: MySubgraph_MoviesTomatoesCriticInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_mongo
      dataConnectorObjectType: movies_tomatoes_critic

---
kind: TypePermissions
version: v1
definition:
  typeName: MoviesTomatoesCritic
  permissions:
    - role: admin
      output:
        allowedFields:
          - meter
          - numReviews
          - rating

---
kind: ObjectType
version: v1
definition:
  name: MoviesTomatoesViewer
  fields:
    - name: meter
      type: Int
    - name: numReviews
      type: Int
    - name: rating
      type: Double
  graphql:
    typeName: MySubgraph_MoviesTomatoesViewer
    inputTypeName: MySubgraph_MoviesTomatoesViewerInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_mongo
      dataConnectorObjectType: movies_tomatoes_viewer

---
kind: TypePermissions
version: v1
definition:
  typeName: MoviesTomatoesViewer
  permissions:
    - role: admin
      output:
        allowedFields:
          - meter
          - numReviews
          - rating

---
kind: ObjectType
version: v1
definition:
  name: MoviesTomatoes
  fields:
    - name: boxOffice
      type: String
    - name: consensus
      type: String
    - name: critic
      type: MoviesTomatoesCritic
    - name: dvd
      type: Date
    - name: fresh
      type: Int
    - name: lastUpdated
      type: Date
    - name: production
      type: String
    - name: rotten
      type: Int
    - name: viewer
      type: MoviesTomatoesViewer
    - name: website
      type: String
  graphql:
    typeName: MySubgraph_MoviesTomatoes
    inputTypeName: MySubgraph_MoviesTomatoesInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_mongo
      dataConnectorObjectType: movies_tomatoes

---
kind: TypePermissions
version: v1
definition:
  typeName: MoviesTomatoes
  permissions:
    - role: admin
      output:
        allowedFields:
          - boxOffice
          - consensus
          - critic
          - dvd
          - fresh
          - lastUpdated
          - production
          - rotten
          - viewer
          - website

---
kind: ObjectType
version: v1
definition:
  name: Movies
  fields:
    - name: id
      type: ObjectId
    - name: awards
      type: MoviesAwards
    - name: cast
      type: "[String!]"
    - name: countries
      type: "[String!]"
    - name: directors
      type: "[String!]"
    - name: fullplot
      type: String
    - name: genres
      type: "[String!]"
    - name: imdb
      type: MoviesImdb
    - name: languages
      type: "[String!]"
    - name: lastupdated
      type: String
    - name: metacritic
      type: Int
    - name: numMflixComments
      type: Int
    - name: plot
      type: String
    - name: poster
      type: String
    - name: rated
      type: String
    - name: released
      type: Date
    - name: runtime
      type: Int
    - name: title
      type: String
    - name: tomatoes
      type: MoviesTomatoes
    - name: type
      type: String
    - name: writers
      type: "[String!]"
    - name: year
      type: ExtendedJson
  graphql:
    typeName: MySubgraph_Movies
    inputTypeName: MySubgraph_MoviesInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_mongo
      dataConnectorObjectType: movies
      fieldMapping:
        id:
          column:
            name: _id
        awards:
          column:
            name: awards
        cast:
          column:
            name: cast
        countries:
          column:
            name: countries
        directors:
          column:
            name: directors
        fullplot:
          column:
            name: fullplot
        genres:
          column:
            name: genres
        imdb:
          column:
            name: imdb
        languages:
          column:
            name: languages
        lastupdated:
          column:
            name: lastupdated
        metacritic:
          column:
            name: metacritic
        numMflixComments:
          column:
            name: num_mflix_comments
        plot:
          column:
            name: plot
        poster:
          column:
            name: poster
        rated:
          column:
            name: rated
        released:
          column:
            name: released
        runtime:
          column:
            name: runtime
        title:
          column:
            name: title
        tomatoes:
          column:
            name: tomatoes
        type:
          column:
            name: type
        writers:
          column:
            name: writers
        year:
          column:
            name: year

---
kind: TypePermissions
version: v1
definition:
  typeName: Movies
  permissions:
    - role: admin
      output:
        allowedFields:
          - id
          - awards
          - cast
          - countries
          - directors
          - fullplot
          - genres
          - imdb
          - languages
          - lastupdated
          - metacritic
          - numMflixComments
          - plot
          - poster
          - rated
          - released
          - runtime
          - title
          - tomatoes
          - type
          - writers
          - year

---
kind: ObjectBooleanExpressionType
version: v1
definition:
  name: MoviesBoolExp
  objectType: Movies
  dataConnectorName: my_mongo
  dataConnectorObjectType: movies
  comparableFields:
    - fieldName: id
      operators:
        enableAll: true
    - fieldName: awards
      operators:
        enableAll: true
    - fieldName: cast
      operators:
        enableAll: true
    - fieldName: countries
      operators:
        enableAll: true
    - fieldName: directors
      operators:
        enableAll: true
    - fieldName: fullplot
      operators:
        enableAll: true
    - fieldName: genres
      operators:
        enableAll: true
    - fieldName: imdb
      operators:
        enableAll: true
    - fieldName: languages
      operators:
        enableAll: true
    - fieldName: lastupdated
      operators:
        enableAll: true
    - fieldName: metacritic
      operators:
        enableAll: true
    - fieldName: numMflixComments
      operators:
        enableAll: true
    - fieldName: plot
      operators:
        enableAll: true
    - fieldName: poster
      operators:
        enableAll: true
    - fieldName: rated
      operators:
        enableAll: true
    - fieldName: released
      operators:
        enableAll: true
    - fieldName: runtime
      operators:
        enableAll: true
    - fieldName: title
      operators:
        enableAll: true
    - fieldName: tomatoes
      operators:
        enableAll: true
    - fieldName: type
      operators:
        enableAll: true
    - fieldName: writers
      operators:
        enableAll: true
    - fieldName: year
      operators:
        enableAll: true
  graphql:
    typeName: MySubgraph_MoviesBoolExp

---
kind: Model
version: v1
definition:
  name: Movies
  objectType: Movies
  source:
    dataConnectorName: my_mongo
    collection: movies
  filterExpressionType: MoviesBoolExp
  orderableFields:
    - fieldName: id
      orderByDirections:
        enableAll: true
    - fieldName: awards
      orderByDirections:
        enableAll: true
    - fieldName: cast
      orderByDirections:
        enableAll: true
    - fieldName: countries
      orderByDirections:
        enableAll: true
    - fieldName: directors
      orderByDirections:
        enableAll: true
    - fieldName: fullplot
      orderByDirections:
        enableAll: true
    - fieldName: genres
      orderByDirections:
        enableAll: true
    - fieldName: imdb
      orderByDirections:
        enableAll: true
    - fieldName: languages
      orderByDirections:
        enableAll: true
    - fieldName: lastupdated
      orderByDirections:
        enableAll: true
    - fieldName: metacritic
      orderByDirections:
        enableAll: true
    - fieldName: numMflixComments
      orderByDirections:
        enableAll: true
    - fieldName: plot
      orderByDirections:
        enableAll: true
    - fieldName: poster
      orderByDirections:
        enableAll: true
    - fieldName: rated
      orderByDirections:
        enableAll: true
    - fieldName: released
      orderByDirections:
        enableAll: true
    - fieldName: runtime
      orderByDirections:
        enableAll: true
    - fieldName: title
      orderByDirections:
        enableAll: true
    - fieldName: tomatoes
      orderByDirections:
        enableAll: true
    - fieldName: type
      orderByDirections:
        enableAll: true
    - fieldName: writers
      orderByDirections:
        enableAll: true
    - fieldName: year
      orderByDirections:
        enableAll: true
  graphql:
    selectMany:
      queryRootField: mySubgraph_movies
    selectUniques: []
    orderByExpressionType: MySubgraph_MoviesOrderBy

---
kind: ModelPermissions
version: v1
definition:
  modelName: Movies
  permissions:
    - role: admin
      select:
        filter: null


```

</details>

## Next steps

:::tip Ready to import _all_ your collections?

You can do this in one convenience command:

```bash
ddn connector-link update my_mongo --subgraph my_subgraph --add-all-resources
```

:::

<!-- prettier-ignore -->
This model can now be used to <BaseUrlLink to="/getting-started/build-your-api" text="query data via your API" />. You
can also customize the model by adding <BaseUrlLink to="/getting-started/add-permissions" text="access control rules"/>,
<BaseUrlLink to="/getting-started/create-a-relationship" text="creating relationships" /> to other entities, or
deprecating certain fields.