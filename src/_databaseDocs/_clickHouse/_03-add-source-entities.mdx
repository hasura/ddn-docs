import BaseUrlLink from '@site/src/_databaseDocs/baseLink';

## What's about to happen?

<!-- prettier-ignore -->
Entities from your ClickHouse database — such as tables — are exposed to your API via <BaseUrlLink to="/supergraph-modeling/models" text="models" />. You can use the CLI to generate an `hml` file which will
represent a model, allowing you to easily and declaratively customize authorization rules, create relationships, or even
deprecate certain fields.

## Add a model

:::tip Required

- <BaseUrlLink to="/getting-started/prerequisites" text="The DDN CLI, VS Code extension, and Docker installed" />
- A new or existing <BaseUrlLink to="/getting-started/init-supergraph" text="supergraph" />
- A new or existing <BaseUrlLink to="/getting-started/init-subgraph" text="subgraph" />
- A <BaseUrlLink to="/getting-started/connect-to-data/connect-a-source" text="ClickHouse connector"/> initialized
- A <BaseUrlLink to="/getting-started/connect-to-data/create-source-metadata" text="DataConnectorLink"/> configured

:::

If you look in your `my_subgraph/metadata/my_clickhouse.hml` file, you'll see `collections` for each table in your
ClickHouse database. For each of these, you can run the following command to create a model:

```bash title="For example, with a collection of users"
ddn model add --connector-link my_clickhouse --name users
```

:::tip Casing matters

When adding a model, it is critical to use the same casing as the `collection` from your connector's configuration file.

:::

## What did this do?

When you ran this command, the CLI generated an `hml` file in the `models` directory for the `collection` you passed it.
This `hml` file contains all the auto-configured information — such as the names and types of fields — along with
serving as a file to which you can add new metadata objects to customize the model.

<details>
  <summary>
    Click here to see an example `hml` file for a model called `Carts`.
  </summary>

```yaml title="Carts.hml"
---
kind: ObjectType
version: v1
definition:
  name: Carts
  fields:
    - name: createdAt
      type: Timestamptz
    - name: id
      type: Uuid!
    - name: isComplete
      type: Bool!
    - name: isReminderSent
      type: Bool!
    - name: updatedAt
      type: Timestamptz
    - name: userId
      type: Uuid!
  graphql:
    typeName: MySubgraph_Carts
    inputTypeName: MySubgraph_CartsInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_clickhouse
      dataConnectorObjectType: carts
      fieldMapping:
        createdAt:
          column:
            name: created_at
        id:
          column:
            name: id
        isComplete:
          column:
            name: is_complete
        isReminderSent:
          column:
            name: is_reminder_sent
        updatedAt:
          column:
            name: updated_at
        userId:
          column:
            name: user_id

---
kind: TypePermissions
version: v1
definition:
  typeName: Carts
  permissions:
    - role: admin
      output:
        allowedFields:
          - createdAt
          - id
          - isComplete
          - isReminderSent
          - updatedAt
          - userId

---
kind: ObjectBooleanExpressionType
version: v1
definition:
  name: CartsBoolExp
  objectType: Carts
  dataConnectorName: my_clickhouse
  dataConnectorObjectType: carts
  comparableFields:
    - fieldName: createdAt
      operators:
        enableAll: true
    - fieldName: id
      operators:
        enableAll: true
    - fieldName: isComplete
      operators:
        enableAll: true
    - fieldName: isReminderSent
      operators:
        enableAll: true
    - fieldName: updatedAt
      operators:
        enableAll: true
    - fieldName: userId
      operators:
        enableAll: true
  graphql:
    typeName: MySubgraph_CartsBoolExp

---
kind: Model
version: v1
definition:
  name: Carts
  objectType: Carts
  source:
    dataConnectorName: my_clickhouse
    collection: carts
  filterExpressionType: CartsBoolExp
  orderableFields:
    - fieldName: createdAt
      orderByDirections:
        enableAll: true
    - fieldName: id
      orderByDirections:
        enableAll: true
    - fieldName: isComplete
      orderByDirections:
        enableAll: true
    - fieldName: isReminderSent
      orderByDirections:
        enableAll: true
    - fieldName: updatedAt
      orderByDirections:
        enableAll: true
    - fieldName: userId
      orderByDirections:
        enableAll: true
  graphql:
    selectMany:
      queryRootField: mySubgraph_carts
    selectUniques:
      - queryRootField: mySubgraph_cartsById
        uniqueIdentifier:
          - id
    orderByExpressionType: MySubgraph_CartsOrderBy

---
kind: ModelPermissions
version: v1
definition:
  modelName: Carts
  permissions:
    - role: admin
      select:
        filter: null
```

</details>

## Next steps

:::tip Ready to import _all_ your tables?

You can do this in one convenience command:

```bash title="From the root of your project, run:"
ddn connector-link update my_clickhouse --subgraph my_subgraph --add-all-resources
```

:::

This model can now be used to <BaseUrlLink to="/getting-started/build-your-api" text="query data via your API" />. You
can also customize the model by adding access-control rules, creating relationships to other entities, or deprecating
certain fields.
