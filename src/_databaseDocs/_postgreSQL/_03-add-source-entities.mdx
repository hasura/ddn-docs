import BaseUrlLink from '@site/src/_databaseDocs/baseLink';

## What's about to happen?

<!-- prettier-ignore -->
Entities from your PostgreSQL database — such as tables, views, or

<BaseUrlLink to="connectors/postgresql/native-queries/" text="native queries" /> — are exposed to your API via -
<BaseUrlLink to="/supergraph-modeling/models" text="models" />. You can use the CLI to generate an `hml` file which will
represent a model, allowing you to easily and declaratively customize authorization rules, create relationships, or even
deprecate certain fields.

## Add a model

:::tip Required

- <BaseUrlLink to="/getting-started/prerequisites" text="DDN CLI" />
- A new or existing <BaseUrlLink to="/getting-started/init-supergraph" text="supergraph" />
- A new or existing <BaseUrlLink to="/getting-started/init-subgraph" text="subgraph" />
- A <BaseUrlLink to="/getting-started/connect-to-data/connect-a-source" text="PostgreSQL connector"/> initialized
- A <BaseUrlLink to="/getting-started/connect-to-data/create-source-metadata" text="DataConnectorLink"/> configured

:::

If you look in your `<subgraph>/connector/my_pg/metadata/my_pg.hml` file, you'll see `object_types` for each table in
your PostgreSQL database. For each of these, you can run the following command to create a model:

```bash
ddn model add --connector-link my_pg --name <object_type>
```

:::tip Casing matters

When adding a model, it is critical to use the same casing as the `object_type` from your connector's configuration
file.

:::

## What did this do?

When you ran this command, the CLI generated an `hml` file in the `models` directory for the `object_type` you passed
it. This `hml` file contains all the auto-configured information — such as the names and types of fields — along with
serving as a file to which you can add new metadata objects to customize the model.

<details>
  <summary>
    Click here to see an example `hml` file for a model.
  </summary>

```yaml
# Carts.hml
---
kind: ObjectType
version: v1
definition:
  name: Carts
  fields:
    - name: createdAt
      type: Timestamptz
    - name: id
      type: Uuid!
    - name: isComplete
      type: Bool!
    - name: isReminderSent
      type: Bool!
    - name: updatedAt
      type: Timestamptz
    - name: userId
      type: Uuid!
  graphql:
    typeName: App_Carts
    inputTypeName: App_CartsInput
  dataConnectorTypeMapping:
    - dataConnectorName: pg_connector
      dataConnectorObjectType: carts
      fieldMapping:
        createdAt:
          column:
            name: created_at
        id:
          column:
            name: id
        isComplete:
          column:
            name: is_complete
        isReminderSent:
          column:
            name: is_reminder_sent
        updatedAt:
          column:
            name: updated_at
        userId:
          column:
            name: user_id

---
kind: TypePermissions
version: v1
definition:
  typeName: Carts
  permissions:
    - role: admin
      output:
        allowedFields:
          - createdAt
          - id
          - isComplete
          - isReminderSent
          - updatedAt
          - userId

---
kind: ObjectBooleanExpressionType
version: v1
definition:
  name: CartsBoolExp
  objectType: Carts
  dataConnectorName: pg_connector
  dataConnectorObjectType: carts
  comparableFields:
    - fieldName: createdAt
      operators:
        enableAll: true
    - fieldName: id
      operators:
        enableAll: true
    - fieldName: isComplete
      operators:
        enableAll: true
    - fieldName: isReminderSent
      operators:
        enableAll: true
    - fieldName: updatedAt
      operators:
        enableAll: true
    - fieldName: userId
      operators:
        enableAll: true
  graphql:
    typeName: App_CartsBoolExp

---
kind: Model
version: v1
definition:
  name: Carts
  objectType: Carts
  source:
    dataConnectorName: pg_connector
    collection: carts
  filterExpressionType: CartsBoolExp
  orderableFields:
    - fieldName: createdAt
      orderByDirections:
        enableAll: true
    - fieldName: id
      orderByDirections:
        enableAll: true
    - fieldName: isComplete
      orderByDirections:
        enableAll: true
    - fieldName: isReminderSent
      orderByDirections:
        enableAll: true
    - fieldName: updatedAt
      orderByDirections:
        enableAll: true
    - fieldName: userId
      orderByDirections:
        enableAll: true
  graphql:
    selectMany:
      queryRootField: app_carts
    selectUniques:
      - queryRootField: app_cartsById
        uniqueIdentifier:
          - id
    orderByExpressionType: App_CartsOrderBy

---
kind: ModelPermissions
version: v1
definition:
  modelName: Carts
  permissions:
    - role: admin
      select:
        filter: null
```

</details>

## Next steps

:::tip Ready to import _all_ your tables?

You can do this in one convenience command, which will also bring in _all_ foreign-key relationships:

```bash
ddn connector-link update <connector-name> --subgraph <subgraph-name> --add-all-resources
```

:::

This model can now be used to <BaseUrlLink to="/getting-started/build-your-api" text="query data via your API" />. You
can also customize the model by adding access-control rules, creating relationships to other entities, or deprecating
certain fields.
