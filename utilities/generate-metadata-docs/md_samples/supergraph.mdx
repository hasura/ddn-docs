## Metadata structure

### AuthConfigV1

Definition of the authentication configuration used by the API server.

| Name                   | Type                              | Required | Description |
| ---------------------- | --------------------------------- | -------- | ----------- |
| `allowRoleEmulationBy` | string / null                     | false    |             |
| `mode`                 | [AuthModeConfig](#authmodeconfig) | true     |             |

### AuthModeConfig

The configuration for the authentication mode to use - webhook or JWT.

Must have exactly one of the following fields:

| Name      | Type                              | Required | Description |
| --------- | --------------------------------- | -------- | ----------- |
| `webhook` | [AuthHookConfig](#authhookconfig) | false    |             |
| `jwt`     | [JWTConfig](#jwtconfig)           | false    |             |

### JWTConfig

JWT config according to which the incoming JWT will be verified and decoded to extract the session variable claims.

| Name            | Type                                  | Required | Description                                                                                                           |
| --------------- | ------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------------- |
| `audience`      | [string]                              | false    | Optional validation to check that the `aud` field is a member of the `audience` recieved, otherwise will throw error. |
| `issuer`        | string                                | false    | Optional validation to check that the `iss` field is a member of the `iss` received, otherwise will throw error.      |
| `allowedSkew`   | integer                               | false    | Allowed leeway (in seconds) to the `exp` validation to account for clock skew.                                        |
| `claimsConfig`  | [JWTClaimsConfig](#jwtclaimsconfig)   | true     | Claims config. Either specified via `claims_mappings` or `claims_namespace_path`                                      |
| `tokenLocation` | [JWTTokenLocation](#jwttokenlocation) | true     | Source of the JWT authentication token.                                                                               |
| `key`           | [JWTKey](#jwtkey)                     | true     | Mode according to which the JWT auth is configured.                                                                   |

**Example**

```yaml
audience: null
issuer: null
allowedSkew: null
claimsConfig:
  namespace:
    claimsFormat: Json
    location: /https:~1~1hasura.io~1jwt~1claims
tokenLocation:
  type: BearerAuthorization
key:
  fixed:
    algorithm: HS256
    key:
      value: token
```

### JWTKey

JWT key configuration according to which the incoming JWT will be decoded.

Must have exactly one of the following fields:

| Name         | Type                          | Required | Description |
| ------------ | ----------------------------- | -------- | ----------- |
| `fixed`      | [JWTKeyConfig](#jwtkeyconfig) | false    |             |
| `jwkFromUrl` | string                        | false    |             |

### JWTKeyConfig

JWT Secret config according to which the incoming JWT will be decoded.

| Name        | Type                                  | Required | Description                           |
| ----------- | ------------------------------------- | -------- | ------------------------------------- |
| `algorithm` | [JWTAlgorithm](#jwtalgorithm)         | true     | The algorithm used to decode the JWT. |
| `key`       | [EnvironmentValue](#environmentvalue) | true     | The key to use for decoding the JWT.  |

### EnvironmentValue

Either a literal string or a reference to a Hasura secret

Must have exactly one of the following fields:

| Name           | Type   | Required | Description |
| -------------- | ------ | -------- | ----------- |
| `value`        | string | false    |             |
| `valueFromEnv` | string | false    |             |

### JWTAlgorithm

The algorithm used to decode the JWT.

string / string / string / string / string / string / string / string / string / string / string / string

### JWTTokenLocation

Source of the Authorization token

[undefined](#undefined) / [JWTCookieLocation](#jwtcookielocation) / [JWTHeaderLocation](#jwtheaderlocation)

### JWTHeaderLocation

Custom header from where the header should be parsed from.

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `type` | string | true     |             |
| `name` | string | true     |             |

### JWTCookieLocation

Get the token from the Cookie header under the specificied cookie name.

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `type` | string | true     |             |
| `name` | string | true     |             |

### undefined

Get the bearer token from the `Authorization` header.

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `type` | string | true     |             |

### JWTClaimsConfig

Config to describe how/where the engine should look for the claims within the decoded token.

Must have exactly one of the following fields:

| Name        | Type                                      | Required | Description |
| ----------- | ----------------------------------------- | -------- | ----------- |
| `locations` | [JWTClaimsMap](#jwtclaimsmap)             | false    |             |
| `namespace` | [JWTClaimsNamespace](#jwtclaimsnamespace) | false    |             |

### JWTClaimsNamespace

Used when all of the Hasura claims are present in a single object within the decoded JWT.

| Name           | Type                                | Required | Description                                                    |
| -------------- | ----------------------------------- | -------- | -------------------------------------------------------------- |
| `claimsFormat` | [JWTClaimsFormat](#jwtclaimsformat) | true     | Format in which the Hasura claims will be present.             |
| `location`     | string                              | true     | Pointer to lookup the Hasura claims within the decoded claims. |

### JWTClaimsFormat

Format in which the Hasura claims will be present.

string / string

### JWTClaimsMap

Can be used when Hasura claims are not all present in the single object, but individual claims are provided a JSON
pointer within the decoded JWT and optionally a default value.

| Name                     | Type                                            | Required | Description                                                      |
| ------------------------ | ----------------------------------------------- | -------- | ---------------------------------------------------------------- |
| `x-hasura-default-role`  | [JWTClaimsMappingEntry](#jwtclaimsmappingentry) | true     | JSON pointer to lookup the default role within the decoded JWT.  |
| `x-hasura-allowed-roles` | [JWTClaimsMappingEntry](#jwtclaimsmappingentry) | true     | JSON pointer to lookup the allowed roles within the decoded JWT. |

### JWTClaimsMappingEntry

JSON pointer to lookup the default role within the decoded JWT.

Must have exactly one of the following fields:

| Name      | Type                                                    | Required | Description |
| --------- | ------------------------------------------------------- | -------- | ----------- |
| `literal` | string                                                  | false    |             |
| `path`    | [JWTClaimsMappingPathEntry](#jwtclaimsmappingpathentry) | false    |             |

### JWTClaimsMappingPathEntry

| Name      | Type          | Required | Description                                                                                 |
| --------- | ------------- | -------- | ------------------------------------------------------------------------------------------- |
| `path`    | string        | true     | JSON pointer to find the particular claim in the decoded JWT token.                         |
| `default` | string / null | false    | Default value to be used when no value is found when looking up the value using the `path`. |

### AuthHookConfig

The configuration of the authentication webhook.

| Name     | Type   | Required | Description                                                      |
| -------- | ------ | -------- | ---------------------------------------------------------------- |
| `url`    | string | true     | The URL of the authentication webhook.                           |
| `method` | string | true     | The HTTP method to be used to make the request to the auth hook. |

**Example**

```yaml
url: http://auth_hook:3050/validate-request
method: Post
```

### GraphqlConfigV1

| Name       | Type                                            | Required | Description |
| ---------- | ----------------------------------------------- | -------- | ----------- |
| `query`    | [QueryGraphqlConfig](#querygraphqlconfig)       | true     |             |
| `mutation` | [MutationGraphqlConfig](#mutationgraphqlconfig) | true     |             |

### MutationGraphqlConfig

| Name                    | Type   | Required | Description |
| ----------------------- | ------ | -------- | ----------- |
| `rootOperationTypeName` | string | true     |             |

### QueryGraphqlConfig

| Name                    | Type                                                               | Required | Description |
| ----------------------- | ------------------------------------------------------------------ | -------- | ----------- |
| `rootOperationTypeName` | string                                                             | true     |             |
| `argumentsInput`        | [ArgumentsInputGraphqlConfig](#argumentsinputgraphqlconfig) / null | false    |             |
| `limitInput`            | [LimitInputGraphqlConfig](#limitinputgraphqlconfig) / null         | false    |             |
| `offsetInput`           | [OffsetInputGraphqlConfig](#offsetinputgraphqlconfig) / null       | false    |             |
| `filterInput`           | [FilterInputGraphqlConfig](#filterinputgraphqlconfig) / null       | false    |             |
| `orderByInput`          | [OrderByInputGraphqlConfig](#orderbyinputgraphqlconfig) / null     | false    |             |

### OrderByInputGraphqlConfig

| Name                  | Type                                              | Required | Description |
| --------------------- | ------------------------------------------------- | -------- | ----------- |
| `fieldName`           | string                                            | true     |             |
| `enumDirectionValues` | [OrderByDirectionValues](#orderbydirectionvalues) | true     |             |
| `enumTypeNames`       | [[OrderByEnumTypeName](#orderbyenumtypename)]     | true     |             |

### OrderByEnumTypeName

| Name         | Type     | Required | Description |
| ------------ | -------- | -------- | ----------- |
| `directions` | [string] | true     |             |
| `typeName`   | string   | true     |             |

### OrderByDirectionValues

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `asc`  | string | true     |             |
| `desc` | string | true     |             |

### FilterInputGraphqlConfig

| Name            | Type                                                  | Required | Description |
| --------------- | ----------------------------------------------------- | -------- | ----------- |
| `fieldName`     | string                                                | true     |             |
| `operatorNames` | [FilterInputOperatorNames](#filterinputoperatornames) | true     |             |

### FilterInputOperatorNames

| Name     | Type   | Required | Description |
| -------- | ------ | -------- | ----------- |
| `and`    | string | true     |             |
| `or`     | string | true     |             |
| `not`    | string | true     |             |
| `isNull` | string | true     |             |

### OffsetInputGraphqlConfig

| Name        | Type   | Required | Description |
| ----------- | ------ | -------- | ----------- |
| `fieldName` | string | true     |             |

### LimitInputGraphqlConfig

| Name        | Type   | Required | Description |
| ----------- | ------ | -------- | ----------- |
| `fieldName` | string | true     |             |

### ArgumentsInputGraphqlConfig

| Name        | Type   | Required | Description |
| ----------- | ------ | -------- | ----------- |
| `fieldName` | string | true     |             |

### AuthHookConfig

The configuration of the authentication webhook.

| Name     | Type   | Required | Description                                                      |
| -------- | ------ | -------- | ---------------------------------------------------------------- |
| `url`    | string | true     | The URL of the authentication webhook.                           |
| `method` | string | true     | The HTTP method to be used to make the request to the auth hook. |

**Example**

```yaml
url: http://auth_hook:3050/validate-request
method: Post
```

### JWTClaimsMappingPathEntry

| Name      | Type          | Required | Description                                                                                 |
| --------- | ------------- | -------- | ------------------------------------------------------------------------------------------- |
| `path`    | string        | true     | JSON pointer to find the particular claim in the decoded JWT token.                         |
| `default` | string / null | false    | Default value to be used when no value is found when looking up the value using the `path`. |

### JWTClaimsMappingEntry

JSON pointer to lookup the default role within the decoded JWT.

Must have exactly one of the following fields:

| Name      | Type                                                    | Required | Description |
| --------- | ------------------------------------------------------- | -------- | ----------- |
| `literal` | string                                                  | false    |             |
| `path`    | [JWTClaimsMappingPathEntry](#jwtclaimsmappingpathentry) | false    |             |

### JWTClaimsMap

Can be used when Hasura claims are not all present in the single object, but individual claims are provided a JSON
pointer within the decoded JWT and optionally a default value.

| Name                     | Type                                            | Required | Description                                                      |
| ------------------------ | ----------------------------------------------- | -------- | ---------------------------------------------------------------- |
| `x-hasura-default-role`  | [JWTClaimsMappingEntry](#jwtclaimsmappingentry) | true     | JSON pointer to lookup the default role within the decoded JWT.  |
| `x-hasura-allowed-roles` | [JWTClaimsMappingEntry](#jwtclaimsmappingentry) | true     | JSON pointer to lookup the allowed roles within the decoded JWT. |

### JWTClaimsFormat

Format in which the Hasura claims will be present.

string / string

### JWTClaimsNamespace

Used when all of the Hasura claims are present in a single object within the decoded JWT.

| Name           | Type                                | Required | Description                                                    |
| -------------- | ----------------------------------- | -------- | -------------------------------------------------------------- |
| `claimsFormat` | [JWTClaimsFormat](#jwtclaimsformat) | true     | Format in which the Hasura claims will be present.             |
| `location`     | string                              | true     | Pointer to lookup the Hasura claims within the decoded claims. |

### JWTClaimsConfig

Config to describe how/where the engine should look for the claims within the decoded token.

Must have exactly one of the following fields:

| Name        | Type                                      | Required | Description |
| ----------- | ----------------------------------------- | -------- | ----------- |
| `locations` | [JWTClaimsMap](#jwtclaimsmap)             | false    |             |
| `namespace` | [JWTClaimsNamespace](#jwtclaimsnamespace) | false    |             |

### undefined

Get the bearer token from the `Authorization` header.

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `type` | string | true     |             |

### JWTCookieLocation

Get the token from the Cookie header under the specificied cookie name.

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `type` | string | true     |             |
| `name` | string | true     |             |

### JWTHeaderLocation

Custom header from where the header should be parsed from.

| Name   | Type   | Required | Description |
| ------ | ------ | -------- | ----------- |
| `type` | string | true     |             |
| `name` | string | true     |             |

### JWTTokenLocation

Source of the Authorization token

[undefined](#undefined) / [JWTCookieLocation](#jwtcookielocation) / [JWTHeaderLocation](#jwtheaderlocation)

### JWTAlgorithm

The algorithm used to decode the JWT.

string / string / string / string / string / string / string / string / string / string / string / string

### EnvironmentValue

Either a literal string or a reference to a Hasura secret

Must have exactly one of the following fields:

| Name           | Type   | Required | Description |
| -------------- | ------ | -------- | ----------- |
| `value`        | string | false    |             |
| `valueFromEnv` | string | false    |             |

### JWTKeyConfig

JWT Secret config according to which the incoming JWT will be decoded.

| Name        | Type                                  | Required | Description                           |
| ----------- | ------------------------------------- | -------- | ------------------------------------- |
| `algorithm` | [JWTAlgorithm](#jwtalgorithm)         | true     | The algorithm used to decode the JWT. |
| `key`       | [EnvironmentValue](#environmentvalue) | true     | The key to use for decoding the JWT.  |

### JWTKey

JWT key configuration according to which the incoming JWT will be decoded.

Must have exactly one of the following fields:

| Name         | Type                          | Required | Description |
| ------------ | ----------------------------- | -------- | ----------- |
| `fixed`      | [JWTKeyConfig](#jwtkeyconfig) | false    |             |
| `jwkFromUrl` | string                        | false    |             |

### JWTConfig

JWT config according to which the incoming JWT will be verified and decoded to extract the session variable claims.

| Name            | Type                                  | Required | Description                                                                                                           |
| --------------- | ------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------------- |
| `audience`      | [string]                              | false    | Optional validation to check that the `aud` field is a member of the `audience` recieved, otherwise will throw error. |
| `issuer`        | string                                | false    | Optional validation to check that the `iss` field is a member of the `iss` received, otherwise will throw error.      |
| `allowedSkew`   | integer                               | false    | Allowed leeway (in seconds) to the `exp` validation to account for clock skew.                                        |
| `claimsConfig`  | [JWTClaimsConfig](#jwtclaimsconfig)   | true     | Claims config. Either specified via `claims_mappings` or `claims_namespace_path`                                      |
| `tokenLocation` | [JWTTokenLocation](#jwttokenlocation) | true     | Source of the JWT authentication token.                                                                               |
| `key`           | [JWTKey](#jwtkey)                     | true     | Mode according to which the JWT auth is configured.                                                                   |

**Example**

```yaml
audience: null
issuer: null
allowedSkew: null
claimsConfig:
  namespace:
    claimsFormat: Json
    location: /https:~1~1hasura.io~1jwt~1claims
tokenLocation:
  type: BearerAuthorization
key:
  fixed:
    algorithm: HS256
    key:
      value: token
```

### AuthModeConfig

The configuration for the authentication mode to use - webhook or JWT.

Must have exactly one of the following fields:

| Name      | Type                              | Required | Description |
| --------- | --------------------------------- | -------- | ----------- |
| `webhook` | [AuthHookConfig](#authhookconfig) | false    |             |
| `jwt`     | [JWTConfig](#jwtconfig)           | false    |             |

### AuthConfigV1

Definition of the authentication configuration used by the API server.

| Name                   | Type                              | Required | Description |
| ---------------------- | --------------------------------- | -------- | ----------- |
| `allowRoleEmulationBy` | string / null                     | false    |             |
| `mode`                 | [AuthModeConfig](#authmodeconfig) | true     |             |
