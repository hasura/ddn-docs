---
sidebar_position: 200
sidebar_label: Migrating to new CLI
description: "Guide to migrate local projects created by CLI versions <= v2024.05.23"
keywords:
  - hasura ddn
  - data delivery network
  - hasura cli
  - project configuration
  - hasura metadata management
  - yaml configuration
  - api development
  - hasura build profiles
  - hasura subgraphs
  - hasura project management
seoFrontMatterUpdated: true
---

# Migrating to new CLI

## What has happened?

A new revision of the DDN CLI has been released. With this release the local project directory
structure created by versions `<= v2024.05.23` is now deprecated.

This page contains some information on what has changed and instructions to migrate your existing local projects.


## What has changed?

- Local dev workflows using Docker have been introduced.
- The DDN CLI commands. See details on the new commands [here](/cli/commands/ddn).
- The local project directory structure. See details on the new structure [here](/project-configuration/config).
- SupergraphManifest and ConnectorManifest objects are now called Supergraph and Connector respectively

We **strongly recommend** you to go through our [new getting started guide](/getting-started/overview) to learn
about all the changes and experience the new workflow to develop your API with DDN.

:::note No changes made to DDN projects

Note that this a CLI only change and does not impact Hasura DDN projects. You can continue using existing DDN projects
and builds and also be able to create new builds using the new CLI revision (with the new local project structure).

:::


## How to migrate an existing local project?

### Step 1: Get the new CLI

Follow the instructions [here](/cli/installation) to get the new DDN CLI.

### Step 2: Create a fresh project directory

```
ddn supergraph init --dir <new-proj-dir>
```

Set the default supergraph config file to the CLI context to avoid having to repeat it in future commands.
```
cd <new-proj-dir> && ddn context set supergraph ./supergraph.yaml
```

### Step 3: Add your subgraphs

For each subgraph in your project, run:

```
ddn subgraph init <subgraph-name>
```

### Step 4: Set up your data connectors

For self-deployed data connectors in your subgraphs, ie. `ConnectorManifest` of type `endpoints`, you can skip this step.

For each data connector deployed on Hasura DDN in your subgraphs, ie. `ConnectorManifest` of type `cloud` follow the
steps below:

#### Step 4.1: Initialize data connector

Run:
```
ddn connector init <connector-name> --subgraph <subgraph-name> --hub-connector <connector-type>
```

Ensure you use the same connector name and type from your existing `ConnectorManifest`.

#### Step 4.2: Add data connector configuration


##### Option 1: For hasura/postgres connectors
  
###### Step 4.2.1: Set database connection string
  
Add a new key `CONNECTION_URI` to the file `<subgraph_name>/connector/<connector_name>/.env.local` and
set your database connection string as the value.

For example:
```
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://local.hasura.dev:4317
OTEL_SERVICE_NAME=mysubgraph_mypg
CONNECTION_URI=<your_pg_url>
```
  
###### Step 4.2.2: Introspect the database schema
  
Run:

```
ddn connector introspect --connector <subgraph-name>/connector/<connector-name>/connector.yaml
```

##### Option 2: For hasura/nodejs connectors

###### Step 4.2.1: Copy over functions

Copy your functions file, typically `functions.ts`, from your existing project directory to
`<subgraph-name>/connector/<connector-name>/functions.ts` in the new project directory.

### Step 5: Copy over connector metadata

For each data connector, copy the following files from your existing project directory to the `<subgraph-name>/metadata`
directory in the new project directory.

- the file with the DataConnectorLink object. Typically `<connector-name>.hml`
- the file with the data connector type objects. Typically `<connector-name>-types.hml`
- the files with Models and Commands. Typically in `models`/`commands` directory.

These files should typically be in the `<subgraph-name>/<connector-name>` directory in your existing project.

Within the `<subgraph-name>/metadata` directory you can choose to arrange these
files however you like.

In the DataConnectorLink object replace the `url` section with:
```
url:
    readWriteUrls:
      read:
        valueFromEnv: <CONNECTOR_NAME>_READ_URL
      write:
        valueFromEnv: <CONNECTOR_NAME>_WRITE_URL
```

TODO: Set url values in .env

### Step 6: Deploy and test migration

TODO

### Step x: Update VSCode extension

Update your Hasura VS Code extension to `v0.6.0` if not done automatically.

## Need help migrating?

[//]: <> (TODO: put proper reach out link)

If you need help migrating your project or have any other questions please reach out to us on
our [Discord](https://hasura.io/discord).