---
sidebar_position: 15
sidebar_label: Engine Plugins
description: "LifecyclePluginHook is a metadata object that defines the configuration for engine lifecyle plugins."
keywords:
  - plugin config
  - engine plugins
  - pre-parse plugin
  - HTTP hooks
  - Lifecycle hooks
  - lifecycle plugin hooks
toc_max_heading_level: 4
---

# Engine Plugins

## Introduction

Engine plugins are a way to extend the functionality of the Hasura GraphQL Engine. Engine plugins are executed at
various stages of the request lifecycle. Engine plugins can be used to modify the request, response, or to perform
custom operations.

### How LifeCyclePluginHooks work

Lifecycle plugin hooks are not generated by default when a Hasura project is created. They need to be manually added to
the metadata. To see a guide, check out [this page](/plugins/quickstart.mdx).

When you create a LifeCyclePluginHook, you define the configuration for the plugin in your metadata by passing
information like the URL of the hosted plugin and its name. The plugin is then executed at the specified stage of the
request lifecycle.

After creating a new LifeCyclePluginHook in your metadata, you'll need to
[create a new build](/cli/commands/ddn_supergraph_build_local.mdx) using the CLI.

### Examples

```yaml title="An example of a LifecyclePluginHook:"
kind: LifecyclePluginHook
version: v1
definition:
name: cloudflare allow list
url:
  valueFromEnv: ALLOW_LIST_URL
pre: parse
config:
  request:
    headers:
      additional:
      hasura-m-auth:
        valueFromEnv: M_AUTH_KEY
    session: {}
    rawRequest:
      query: {}
      variables: {}
```

| Field                       | Description                                                               | Reference                                                                                 |
| --------------------------- | ------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| `name`                      | The name of the lifecycle plugin hook.                                    | [LifecyclePluginHookPreParse](#lifecyclepluginhook-lifecyclepluginhookpreparse)           |
| `url`                       | The URL to access the plugin.                                             | [LifecyclePluginHookPreParse](#lifecyclepluginhook-lifecyclepluginhookpreparse)           |
| `pre`                       | The stage of the request lifecycle.                                       | [LifecyclePluginHookPreParse](#lifecyclepluginhook-lifecyclepluginhookpreparse)           |
| `config`                    | Configuration for the plugin.                                             | [LifecyclePluginHookConfig](#lifecyclepluginhook-lifecyclepluginhookconfig)               |
| `config.request`            | The shape of the request object.                                          | [LifecyclePluginHookConfigRequest](#lifecyclepluginhook-lifecyclepluginhookconfigrequest) |
| `config.request.headers`    | The headers that should be included for each request.                     | [LifecyclePluginHookHeadersConfig](#lifecyclepluginhook-lifecyclepluginhookheadersconfig) |
| `config.request.rawRequest` | The configuration of the raw request, including any queries or variables. | [RawRequestConfig](#lifecyclepluginhook-rawrequestconfig)                                 |

## Metadata structure

### LifecyclePluginHook {#lifecyclepluginhook-lifecyclepluginhook}

Definition of a lifecycle plugin hook.

| Key          | Value                                                                           | Required | Description |
| ------------ | ------------------------------------------------------------------------------- | -------- | ----------- |
| `kind`       | `LifecyclePluginHook`                                                           | true     |             |
| `version`    | `v1`                                                                            | true     |             |
| `definition` | [LifecyclePluginHookPreParse](#lifecyclepluginhook-lifecyclepluginhookpreparse) | true     |             |

**Example:**

```yaml
kind: LifecyclePluginHook
version: v1
definition:
  pre: parse
  name: test
  url: http://localhost:8080
  config:
    request:
      headers:
        additional:
          hasura-m-auth:
            value: zZkhKqFjqXR4g5MZCsJUZCnhCcoPyZ
      session: {}
      rawRequest:
        query: {}
        variables: {}
```

#### LifecyclePluginHookPreParse {#lifecyclepluginhook-lifecyclepluginhookpreparse}

Definition of a lifecycle plugin hook for the pre-parse stage.

| Key      | Value                                                                       | Required | Description                                  |
| -------- | --------------------------------------------------------------------------- | -------- | -------------------------------------------- |
| `pre`    | `parse`                                                                     | true     |                                              |
| `name`   | string                                                                      | true     | The name of the lifecycle plugin hook.       |
| `url`    | string                                                                      | true     | The URL to access the lifecycle plugin hook. |
| `config` | [LifecyclePluginHookConfig](#lifecyclepluginhook-lifecyclepluginhookconfig) | true     | Configuration for the lifecycle plugin hook. |

#### LifecyclePluginHookConfig {#lifecyclepluginhook-lifecyclepluginhookconfig}

Configuration for a lifecycle plugin hook.

| Key       | Value                                                                                     | Required | Description                                                 |
| --------- | ----------------------------------------------------------------------------------------- | -------- | ----------------------------------------------------------- |
| `request` | [LifecyclePluginHookConfigRequest](#lifecyclepluginhook-lifecyclepluginhookconfigrequest) | true     | Configuration for the request to the lifecycle plugin hook. |

#### LifecyclePluginHookConfigRequest {#lifecyclepluginhook-lifecyclepluginhookconfigrequest}

Configuration for a lifecycle plugin hook request.

| Key          | Value                                                                                            | Required | Description                                                           |
| ------------ | ------------------------------------------------------------------------------------------------ | -------- | --------------------------------------------------------------------- |
| `headers`    | [LifecyclePluginHookHeadersConfig](#lifecyclepluginhook-lifecyclepluginhookheadersconfig) / null | false    | Configuration for the headers.                                        |
| `session`    | LeafConfig / null                                                                                | false    | Configuration for the session (includes roles and session variables). |
| `rawRequest` | [RawRequestConfig](#lifecyclepluginhook-rawrequestconfig)                                        | true     | Configuration for the raw request.                                    |

#### RawRequestConfig {#lifecyclepluginhook-rawrequestconfig}

Configuration for the raw request.

| Key         | Value             | Required | Description                      |
| ----------- | ----------------- | -------- | -------------------------------- |
| `query`     | LeafConfig / null | false    | Configuration for the query.     |
| `variables` | LeafConfig / null | false    | Configuration for the variables. |

#### LifecyclePluginHookHeadersConfig {#lifecyclepluginhook-lifecyclepluginhookheadersconfig}

Configuration for a lifecycle plugin hook headers.

| Key          | Value                                                  | Required | Description                                        |
| ------------ | ------------------------------------------------------ | -------- | -------------------------------------------------- |
| `additional` | [HttpHeaders](#lifecyclepluginhook-httpheaders) / null | false    | Additional headers to be sent with the request.    |
| `forward`    | [string]                                               | false    | Headers to be forwarded from the incoming request. |

#### HttpHeaders {#lifecyclepluginhook-httpheaders}

Key value map of HTTP headers to be sent with an HTTP request. The key is the header name and the value is a potential
reference to an environment variable.

| Key           | Value                                                     | Required | Description |
| ------------- | --------------------------------------------------------- | -------- | ----------- |
| `<customKey>` | [EnvironmentValue](#lifecyclepluginhook-environmentvalue) | false    |             |

#### EnvironmentValue {#lifecyclepluginhook-environmentvalue}

Either a literal string or a reference to a Hasura secret

**Must have exactly one of the following fields:**

| Key            | Value  | Required | Description |
| -------------- | ------ | -------- | ----------- |
| `value`        | string | false    |             |
| `valueFromEnv` | string | false    |             |
