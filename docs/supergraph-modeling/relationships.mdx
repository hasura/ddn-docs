---
sidebar_position: 7
sidebar_label: Relationships
description:
  "Expand your understanding of relationships in Hasura, learn how to define linked or nested data queries, create
  relationships between types and models. Explore mapping relationships with in-depth annotated examples and explore
  connecting data across namespaces."
keywords:
  - hasura relationships
  - data mapping
  - graphql queries
  - linked data queries
  - nested data queries
  - hasura data modeling
  - data connectivity
  - hasura data sources
  - hasura api configuration
toc_max_heading_level: 4
seoFrontMatterUpdated: true
---

import GraphiQLIDE from "@site/src/components/GraphiQLIDE";

# Relationships

## Introduction

A relationship allows you to query nested or linked information. This allows you to extend [type](./types.mdx) objects
with related [models](./models.mdx) or related [commands](./commands.mdx).

Relationships can take one of two forms:

| Type of relationship | Description                                                                                      |
| -------------------- | ------------------------------------------------------------------------------------------------ |
| Model-to-model       | A relationship between two models, allowing you to query related data from one model to another. |
| Model-to-command     | A relationship between a model and a command, allowing you to query related data from a command. |

The former is the most common relationship type, allowing you to query related data from one model to another. This
enables you to create nested queries, allowing you to fetch related data in a single query.

The latter is a more advanced relationship type, allowing you to query related data from a command. This is useful when
you want to query data from a command that is not directly related to a model and even return the data in a nested
format. You can imagine enriching or transforming data from a command and returning it as part of a nested query,
thereby saving the need for multiple queries or data transformations in your application.

For example, let's say you have a `user` type in your graph, and also a command which responds with the current
logged-in user information (say `getLoggedInUserInfo`). Now you can link these two, by defining a relationship from the
`user` type to `getLoggedInUserInfo`.

Let's say we name the relationship `currentSession`. Now you can make a single query from your client to get a user's
data and their current session information.

**Example:** fetch a list of users and the current session information of each user:

<GraphiQLIDE
  query={`query {
  users {
    id
    username
    currentSession {
      activeSince
    }
  }
}`}
  response={`{
  "data": {
    "users": [
      {
        "id": 1,
        "username": "sit_amet",
        "currentSession": {
          "activeSince": "2024-04-01T07:08:22+0000"
        }
      },
      {
        "id": 2,
        "username": "fancy_nibh",
        "currentSession": {
          "activeSince": "2024-04-01T07:08:22+0000"
        }
      },
      {
        "id": 3,
        "username": "just_joe",
        "currentSession": {
          "activeSince": "2024-04-01T07:08:22+0000"
        }
      }
    ]
  }
}`}
/>

:::info LSP-assisted authoring

Relationships are written in your various HML files. If you're using a compatible editor (such as VS Code with the
[Hasura extension](https://marketplace.visualstudio.com/items?itemName=HasuraHQ.hasura)), LSP-assisted authoring will
help you create relationships more efficiently. LSP will provide you with auto-completion, syntax highlighting, and
error checking as you write your relationships.

The CLI also works to automatically track your relationships for you whenever you add or update a data connector.

:::

## Metadata structure

### Relationship {#relationship-relationship}

Definition of a relationship on an OpenDD type which allows it to be extended with related models or commands.

| Key          | Value                                          | Required | Description                                                                                                    |
| ------------ | ---------------------------------------------- | -------- | -------------------------------------------------------------------------------------------------------------- |
| `kind`       | `Relationship`                                 | true     |                                                                                                                |
| `version`    | `v1`                                           | true     |                                                                                                                |
| `definition` | [RelationshipV1](#relationship-relationshipv1) | true     | Definition of a relationship on an OpenDD type which allows it to be extended with related models or commands. |

#### RelationshipV1 {#relationship-relationshipv1}

Definition of a relationship on an OpenDD type which allows it to be extended with related models or commands.

| Key           | Value                                                      | Required | Description                                                                                                                  |
| ------------- | ---------------------------------------------------------- | -------- | ---------------------------------------------------------------------------------------------------------------------------- |
| `name`        | [RelationshipName](#relationship-relationshipname)         | true     | The name of the relationship.                                                                                                |
| `source`      | [CustomTypeName](#relationship-customtypename)             | true     | The source type of the relationship.                                                                                         |
| `target`      | [RelationshipTarget](#relationship-relationshiptarget)     | true     | The target of the relationship.                                                                                              |
| `mapping`     | [[RelationshipMapping](#relationship-relationshipmapping)] | true     | The mapping configuration of source to target for the relationship.                                                          |
| `description` | string                                                     | false    | The description of the relationship. Gets added to the description of the relationship in the graphql schema.                |
| `deprecated`  | [Deprecated](#relationship-deprecated) / null              | false    | Whether this relationship is deprecated. If set, the deprecation status is added to the relationship field's graphql schema. |

**Example:**

```yaml
name: Articles
source: author
target:
  model:
    name: Articles
    subgraph: null
    relationshipType: Array
mapping:
  - source:
      fieldPath:
        - fieldName: author_id
    target:
      modelField:
        - fieldName: author_id
description: Articles written by an author
```

#### Deprecated {#relationship-deprecated}

OpenDd configuration to indicate whether an object type field, relationship, model root field or command root field is
deprecated.

| Key      | Value  | Required | Description                 |
| -------- | ------ | -------- | --------------------------- |
| `reason` | string | false    | The reason for deprecation. |

#### RelationshipMapping {#relationship-relationshipmapping}

Definition of a how a particular field in the source maps to a target field or argument.

| Key      | Value                                                                | Required | Description                                             |
| -------- | -------------------------------------------------------------------- | -------- | ------------------------------------------------------- |
| `source` | [RelationshipMappingSource](#relationship-relationshipmappingsource) | true     | The source configuration for this relationship mapping. |
| `target` | [RelationshipMappingTarget](#relationship-relationshipmappingtarget) | true     | The target configuration for this relationship mapping. |

**Example:**

```yaml
source:
  fieldPath:
    - fieldName: author_id
target:
  modelField:
    - fieldName: author_id
```

#### RelationshipMappingTarget {#relationship-relationshipmappingtarget}

The target configuration for a relationship mapping.

**Must have exactly one of the following fields:**

| Key          | Value                                                                          | Required | Description |
| ------------ | ------------------------------------------------------------------------------ | -------- | ----------- |
| `argument`   | [ArgumentMappingTarget](#relationship-argumentmappingtarget)                   | false    |             |
| `modelField` | [[RelationshipSourceFieldAccess](#relationship-relationshipsourcefieldaccess)] | false    |             |

#### ArgumentMappingTarget {#relationship-argumentmappingtarget}

| Key            | Value                                      | Required | Description |
| -------------- | ------------------------------------------ | -------- | ----------- |
| `argumentName` | [ArgumentName](#relationship-argumentname) | true     |             |

#### ArgumentName {#relationship-argumentname}

**Value:** string

#### RelationshipMappingSource {#relationship-relationshipmappingsource}

The source configuration for a relationship mapping.

**Must have exactly one of the following fields:**

| Key         | Value                                                                          | Required | Description                                                               |
| ----------- | ------------------------------------------------------------------------------ | -------- | ------------------------------------------------------------------------- |
| `value`     | [ValueExpression](#relationship-valueexpression)                               | false    | An expression which evaluates to a value that can be used in permissions. |
| `fieldPath` | [[RelationshipSourceFieldAccess](#relationship-relationshipsourcefieldaccess)] | false    |                                                                           |

#### RelationshipSourceFieldAccess {#relationship-relationshipsourcefieldaccess}

| Key         | Value                                | Required | Description |
| ----------- | ------------------------------------ | -------- | ----------- |
| `fieldName` | [FieldName](#relationship-fieldname) | true     |             |

#### FieldName {#relationship-fieldname}

The name of a field in a user-defined object type.

**Value:** string

#### ValueExpression {#relationship-valueexpression}

An expression which evaluates to a value that can be used in permissions.

**Must have exactly one of the following fields:**

| Key               | Value  | Required | Description |
| ----------------- | ------ | -------- | ----------- |
| `literal`         |        | false    |             |
| `sessionVariable` | string | false    |             |

#### RelationshipTarget {#relationship-relationshiptarget}

The target for a relationship.

**Must have exactly one of the following fields:**

| Key       | Value                                                                | Required | Description                            |
| --------- | -------------------------------------------------------------------- | -------- | -------------------------------------- |
| `model`   | [ModelRelationshipTarget](#relationship-modelrelationshiptarget)     | false    | The target model for a relationship.   |
| `command` | [CommandRelationshipTarget](#relationship-commandrelationshiptarget) | false    | The target command for a relationship. |

**Example:**

```yaml
model:
  name: Articles
  subgraph: null
  relationshipType: Array
```

#### CommandRelationshipTarget {#relationship-commandrelationshiptarget}

The target command for a relationship.

| Key        | Value                                    | Required | Description                                                           |
| ---------- | ---------------------------------------- | -------- | --------------------------------------------------------------------- |
| `name`     | [CommandName](#relationship-commandname) | true     | The name of the command.                                              |
| `subgraph` | string                                   | false    | The subgraph of the target command. Defaults to the current subgraph. |

#### CommandName {#relationship-commandname}

The name of a command.

**Value:** string

#### ModelRelationshipTarget {#relationship-modelrelationshiptarget}

The target model for a relationship.

| Key                | Value                                              | Required | Description                                                         |
| ------------------ | -------------------------------------------------- | -------- | ------------------------------------------------------------------- |
| `name`             | [ModelName](#relationship-modelname)               | true     | The name of the data model.                                         |
| `subgraph`         | string                                             | false    | The subgraph of the target model. Defaults to the current subgraph. |
| `relationshipType` | [RelationshipType](#relationship-relationshiptype) | true     | Type of the relationship - object or array.                         |

#### RelationshipType {#relationship-relationshiptype}

Type of the relationship.

**One of the following values:**

| Value    | Description                                      |
| -------- | ------------------------------------------------ |
| `Object` | Select one related object from the target.       |
| `Array`  | Select multiple related objects from the target. |

#### ModelName {#relationship-modelname}

The name of data model.

**Value:** string

#### CustomTypeName {#relationship-customtypename}

The name of a user-defined type.

**Value:** string

#### RelationshipName {#relationship-relationshipname}

The name of the GraphQL relationship field.

**Value:** string
