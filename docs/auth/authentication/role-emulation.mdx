---
description: Explore how to set up role emulation with Hasura, allowing certain roles to emulate other roles. Learn about the AuthConfig Hasura metadata object and the allowRoleEmulationFor field.
keywords: 
  - hasura
  - role-emulation
  - authconfig
  - metadata
  - authentication
  - development
  - access-control 
  - graphql
  - http request
  - session variables
sidebar_position: 5
sidebar_label: Role Emulation
seoFrontMatterUpdated: true
---

# Role Emulation

## Introduction

You can configure authentication to allow certain roles to emulate other roles. This can be useful during development
to test access-control rules without setting up authentication.

To set up role emulation, the `AuthConfig` Hasura metadata object accepts a field called `allowRoleEmulationFor`.

When `allowRoleEmulationFor` is set up, Hasura will check for the value of the `x-hasura-role` session variable
which is returned in the webhook or JWT response to be equal to the value set in the `allowRoleEmulationFor`. If the
values are equal, then role emulation will be enabled for that request. When role emulation is enabled for a request,
the session variables, including the role, will be considered from the HTTP request headers instead.

In the example below, we set up role emulation for the `admin` role, allowing an `admin` to emulate the other roles:

```json
{
  "kind": "AuthConfig",
  "allowRoleEmulationFor": "admin",
  "webhook": {
    "webhookUrl": "https://myauth.service.com/validate-request"
  }
}
```

Then, the following GraphQL request is made:

```http
POST /graphql HTTP/2.0
Content-Type: application/json
x-hasura-role: user
x-hasura-user-id: 2

{
  "query": "query GetUser { user { id name } }",
  "variables": null,
  "operationName": "GetUser"
}
```

This request will be executed as the `user` role with access-control rules applied for the `user` role to the request,
returning only the `id` and `name` fields of the user with `id` 2.

### Successful role emulation

Let's assume the webhook response is as follows:

```json
{
  "x-hasura-role": "user",
  "x-hasura-user-id": 1
}
```

Then, the GraphQL request will be executed as the `user` role, instead of the `admin` role and the session variables
from the HTTP request headers will be considered. So, in this case, the value of the session variable `x-hasura-user-id`
will be 2, instead of 1.

### Unsuccessful role emulation

If the webhook response were the following:

```json
{
  "x-hasura-role": "author",
  "x-hasura-user-id": 1
}
```

Then, the GraphQL query will be executed as the `author` role and **only** the session variables from the authentication
webhook response will be considered. So, in this case, the value of the session variable `x-hasura-user-id` will be 1.
