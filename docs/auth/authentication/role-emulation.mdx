---
description: Explore how to set up role emulation with Hasura, allowing certain roles to emulate other roles. Learn about the AuthConfig Hasura metadata object and the allowRoleEmulationBy field.
keywords: 
  - hasura
  - role-emulation
  - authconfig
  - metadata
  - authentication
  - development
  - access-control 
  - graphql
  - http request
  - session variables
sidebar_position: 5
sidebar_label: Role Emulation
seoFrontMatterUpdated: true
---

# Role Emulation

## Introduction

You can configure authentication to allow certain roles to emulate other roles. This can be useful during development
to test access-control rules without setting up authentication.

To set up role emulation, the `AuthConfig` Hasura metadata object accepts a field called `allowRoleEmulationBy`.

When `allowRoleEmulationBy` is set up, Hasura will check for the value of the `x-hasura-role` session variable
which is returned in the webhook or JWT response to be equal to the value set in the `allowRoleEmulationBy`. If the
values are equal, then role emulation will be enabled for that request. When role emulation is enabled for a request,
the session variables, including the role, will be considered from the HTTP request headers instead.

In the example below, we set up role emulation for the `user` role, allowing a `user` to emulate the other roles:

```yaml
---
kind: AuthConfig
version: v1
definition:
  allowRoleEmulationBy: user
  webhook:
    webhookUrl: https://myauth.service.com/validate-request

```

Then, the following GraphQL request is made:

```http
POST /graphql HTTP/2.0
Content-Type: application/json
x-hasura-role: author
x-hasura-author-id: 2

{
  "query": "query GetAuthor { author { id name } }",
  "variables": null,
  "operationName": "GetAuthor"
}
```

This request will be executed as the `author` role with access-control rules applied for the `author` role to the
request, returning only the `id` and `name` fields of the author with `id` 2.

### Successful role emulation

Let's assume the webhook response is as follows:

```json
{
  "x-hasura-role": "user"
}
```

Then, the GraphQL request will be executed as the `author` role, instead of the `user` role and role emulation is
enabled for this request. Hence the session variables from the HTTP request headers will be considered and the value of
 the session variable `x-hasura-author-id` will be 2 as specified in the request headers.

If webhook response is as follows:

```json
{
  "x-hasura-role": "user",
  "x-hasura-author-id": 1
}
```

Even in this case, the GraphQL request will be executed as the `author` role, instead of the `user` role and role
emulation is enabled for this request. Hence the session variables will be considered from the HTTP request headers and
not the authentication webhook response. So, the value of the session variable `x-hasura-author-id` will be 2 and not 1.

### Unsuccessful role emulation

If the webhook response were the following:

```json
{
  "x-hasura-role": "author",
  "x-hasura-author-id": 1
}
```

Then, the GraphQL query will be executed as the `author` role and **only** the session variables from the authentication
webhook response will be considered. So, in this case, the value of the session variable `x-hasura-author-id` will be 1
as returned by the authentication webhook response and not 2 as specified in the request headers.
