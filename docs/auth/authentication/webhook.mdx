---
description: Learn how to use authentication with webhooks in Hasura and configure the Hasura Engine to authorize incoming requests.
keywords:
  - hasura
  - graphql
  - authentication
  - auth
  - webhook
  - hasura webhook mode
  - hasura engine
  - webhook service
  - hasura auth
  - hasura user-role
sidebar_position: 4
sidebar_label: Authentication Using a Webhook
seoFrontMatterUpdated: true
---

import Thumbnail from '@site/src/components/Thumbnail';

# Authentication Using a Webhook

## Introduction

You can configure the Hasura Engine to use webhook mode in order to authenticate incoming requests.

This process of using webhook mode for authentication with Hasura requires specifying a URL - which Hasura calls with
the original request headers - that then returns a body containing the user information in session variables.

<Thumbnail src="/img/auth/auth-webhook-overview-diagram.png" alt="Authentication using webhooks" width="1000px" />

The webhook service will use your request headers to determine the auth status of the user and return the user role and
any other information as session variables in the response body.

## Configuring webhook mode

You can configure Hasura to run in webhook mode by running the GraphQL Engine by adding an object endpoint to your
metadata.

### Example

```yaml
---
kind: AuthConfig
version: v1
definition:
  allowRoleEmulationBy: admin
  webhook:
    webhookUrl: http://auth.yourservice.com/validate-request
```

| Field        | Type   | Required | Description                                                                                                                             |
|--------------|--------|----------|-----------------------------------------------------------------------------------------------------------------------------------------|
| `webhookUrl` | URL    | true     | URL of the authentication webhook.                                                                                                       |
| `mode`       | String | false    | HTTP method to use while making the request to the authentication webhook. Only `Get` and `Post` methods are supported (default: `Get`). |



:::info Note

If you are running Hasura using Docker, ensure that the Hasura Docker container can reach the webhook.

:::

## Spec for webhook requests {#webhook-request}

### GET request Example

```http
GET https://<your-custom-webhook-url>/ HTTP/1.1
<Header-Key>: <Header-Value>
```

If you configure your webhook to use `Get`, then Hasura **will forward all client headers except**:

- `Content-Length`
- `Content-Type`
- `Content-MD5`
- `User-Agent`
- `Host`
- `Origin`
- `Referer`
- `Accept`
- `Accept-Encoding`
- `Accept-Language`
- `Accept-Datetime`
- `Cache-Control`
- `Connection`
- `DNT`

#### POST request Example

`Post` requests will receive **all the client headers**. Given a request like:

```graphql
query UserQuery($a: Int) {
  users(where: { id: { _eq: $a } }) {
    id
  }
}
```

with variables `{"a": 1}`, the webhook will receive a request in the following form:

```http
POST https://<your-custom-webhook>/ HTTP/1.1
Content-Type: application/json

{
  "headers": {
    "header-key1": "header-value1",
    "header-key2": "header-value2"
  }
}
```

:::info Invalid requests

If an invalid JSON request is sent, then the request body is not forwarded to the webhook

:::

## Spec for webhook responses {#webhook-response}

### Success

To allow the GraphQL request to go through, your webhook must return a `200` status code.

You will, at least, need to set the `x-hasura-role` session variable to let the Hasura Engine know which role to use for
this request. Unlike JWT auth mode, you do not have to pass `x-hasura-allowed-roles` or `x-hasura-default-role` session
variables. This is because the webhook is called for each request, allowing the auth service to easily switch the user
role if needed.

In the example below the `x-hasura-is-owner` and `x-hasura-custom` are examples of custom session variables which
will be available to your permission rules in Hasura Engine.

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
    "x-hasura-user-id": "25",
    "X-hasura-role": "user",
    "X-hasura-is-owner": "true",
    "X-hasura-custom": "custom value"
}
```

:::info Value types

All values should be `String`. They will be converted to the right type automatically upon receipt.

:::

:::info Set-Cookie headers

If `Set-Cookie` HTTP headers are set by the auth webhook, they are forwarded by Hasura Engine as response headers for
both GET/POST request methods.

:::

### Auth denial

If you want to deny the GraphQL request, return a `401 Unauthorized` exception.

```http
HTTP/1.1 401 Unauthorized
```

[//]: # (## Auth webhook samples)

[//]: # ()
[//]: # (We have put together a)

[//]: # ([GitHub Node.js repo]&#40;https://github.com/hasura/graphql-engine/tree/master/community/boilerplates/auth-webhooks/nodejs-express&#41;)

[//]: # (that has some sample auth webhooks configured.)

[//]: # ()
[//]: # (You can deploy these samples using [glitch]&#40;https://glitch.com/&#41;:)

[//]: # ()
[//]: # ([<img src="https://raw.githubusercontent.com/hasura/sample-auth-webhook/master/assets/deploy-glitch.png" className="no-shadow" width="200" alt="deploy_auth_webhook_with_glitch" />]&#40;http://glitch.com/edit/#!/import/github/hasura/sample-auth-webhook&#41;)

[//]: # ()
[//]: # (Once deployed, you can use any of the following endpoints as your auth webhook in the GraphQL Engine:)

[//]: # ()
[//]: # (- `/simple/webhook`)

[//]: # (  &#40;[View source]&#40;https://github.com/hasura/graphql-engine/blob/master/community/boilerplates/auth-webhooks/nodejs-express/server.js&#41;&#41;)

[//]: # (- `/firebase/webhook`)

[//]: # (  &#40;[View source]&#40;https://github.com/hasura/graphql-engine/blob/master/community/boilerplates/auth-webhooks/nodejs-firebase/firebase/firebaseHandler.js&#41;&#41;)

[//]: # ()
[//]: # (:::info Firebase environment variables)

[//]: # ()
[//]: # (If you are using `Firebase`, you will need to set the associated environment variables.)

[//]: # ()
[//]: # (:::)
