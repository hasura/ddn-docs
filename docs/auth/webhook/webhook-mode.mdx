---
description:
  "Learn how to set up your Hasura DDN project with Webhook mode to authenticate requests and apply access-control
  rules."
keywords:
  - hasura webhook mode
  - hasura engine authentication
  - graphql request authentication
  - webhook authentication
  - webhook configuration
  - api authorization
  - hasura api requests
  - session variables
  - hasura user-role
sidebar_position: 2
---

import Thumbnail from "@site/src/components/Thumbnail";

# Webhook Mode

## Introduction

You can enable your Hasura DDN instance to use an auth webhook in just a few steps.

You will need to provide a URL that Hasura will call with the original request headers, and it should return a body with
the session variables after the request is authenticated.

<Thumbnail src="/img/auth/auth-webhook-overview-diagram.png" alt="Authentication using webhooks" width="1000px" />

## Enabling Webhook authentication

## Step 1. Update your AuthConfig {#update-authconfig}

Hasura utilizes an [AuthConfig](/supergraph-modeling/auth-config.mdx) object that allows you to define the configuration
for your authentication service. In a standard setup the `auth-config.hml` file can be found in your `globals`
directory.

:::tip Hasura DDN VS Code extension

You can use [Hasura's VS Code extension](https://marketplace.visualstudio.com/items?itemName=HasuraHQ.hasura) to
scaffold out your `AuthConfig` object by typing `AuthConfig` and selecting this object from the list of available
options. As you navigate through the skeleton, you can type `CTRL+SPACEBAR` at any point to reveal options for the
different key-value pairs.

:::

In the example below, we're demonstrating a sample authentication webhook.

```yaml title="globals/metadata/auth-config.hml"
kind: AuthConfig
version: v2
definition:
  mode:
    webhook:
      url: http://auth_hook:3050/validate-request
      method: Post
```

:::info GET vs POST

What we've provided above is a sample configuration as a POST request but it can be configured as a GET request. See the
reference for `AuthHookConfig` [here](/supergraph-modeling/auth-config.mdx#authconfig-authhookconfig)

:::

## Step 2. Shaping the webhook request and response

### Request

Your webhook should accept either a GET or POST request. Below is an example of the request headers your webhook might
process:

```json title="Example headers present in a POST request to your webhook endpoint"
{
  "headers": {
    "Authorization": "Bearer some-token",
    "Content-Type": "application/json"
  }
}
```

Headers are forwarded to the auth webhook from the client on each request received by the Hasura engine.

In this example, we're passing an encoded JWT in the `Authorization` header, however webhook mode is flexible and you
can pass any headers you wish.

### Token Parsing

In this example, the webhook is then responsible for validating and parsing the token passed in the header. It will need
to:

- **Extract the Token:** Retrieve the Authorization header from the incoming request and extract the token.

- **Validate the Token:** Use a library or your own logic to validate the token. This involves verifying the token's
  signature with the secret key.

- **Extract Claims:** Decode the token to extract the claims.

### Response

Based on the validation result, the webhook will need to respond with either a `200` status code (for a valid token) or
a `401` status code (for an invalid or missing token).

You should respond with session variables beginning with `X-Hasura-*` in an object in the **body** of your response. The
value of each session variable can be any JSON value. These will be available to your
[permissions](/supergraph-modeling/permissions.mdx) in Hasura.

You will, at least, need to set the `X-Hasura-Role` session variable to let the Hasura DDN know which role to use for
this request. Unlike [JWT auth mode](auth/jwt/jwt-mode.mdx), you do not have to pass `X-Hasura-Allowed-Roles` or
`X-Hasura-Default-Role` session variables.

In the example below the `X-Hasura-Is-Owner` and `X-Hasura-Custom` are examples of custom session variables which can be
used to enforce permissions in your supergraph.

```json title="Example response from your webhook to Hasura DDN"
HTTP/1.1 200 OK
Content-Type: application/json

{
    "X-Hasura-User-Id": 25,
    "X-Hasura-Role": "user",
    "X-Hasura-Is-Owner": "true",
    "X-Hasura-Custom": "custom value"
}
```

## Step 3. Define permissions

{/* TODO: Write this section */}

## Step 4. Rebuild your supergraph

```bash title="For example, from the root of your project, run:"
ddn supergraph build local \
  --supergraph supergraph.yaml \
  --env-file .env
```

## Step 5. Make an authenticated request

In the example above, we're using the `BearerAuthorization` method. As such, as we can make a request to our Hasura DDN
instance by including a header with the key-value of `Authorization: Bearer <our-encoded-token>`. For testing, you can
pass this value in the Hasura DDN console's header section.
