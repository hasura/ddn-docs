---
description: Role emulation
keywords:
  - authentication
  - auth
  - role-emulation
sidebar_position: 5
sidebar_label: Role Emulation
---

# Role emulation

## Introduction

Hasura can be set up to emulate roles i.e. process the request using the defined access-control rules
for some other role. This can be useful to test the access-control rules without setting up authentication
for the said role.

To set  up role emulation, the `AuthConfig` Hasura metadata object accepts a field called `allowRoleEmulationFor`.

When `allowRoleEmulationFor` is set up, Hasura will check for the value of the `x-hasura-role` session variable
which is returned in the webhook or JWT response to be equal to the value set in the `allowRoleEmulationFor`. If the
values are equal, then role emulation will be enabled for that request. When role emulation is enabled for a request,
the session variables, including the role, will be considered from the HTTP request headers instead.

For example,

Hasura is set up with the following auth config:

```json
{
  "type": "AuthConfig",
  "allowRoleEmulationFor": "admin",
  "webhook": {
    "webhookUrl": "https://myauth.service.com/validate-request"
  }
}
```

and the following GraphQL request is made:

```http
POST /graphql HTTP/2.0
Content-Type: application/json
x-hasura-role: user
x-hasura-user-id: 2

{
  "query": "query GetUser { user { id name } }",
  "variables": null,
  "operationName": "GetUser"
}
```

### Successful role emulation

Let's assume the webhook response is as following:

```json
{
  "x-hasura-role": "admin",
  "x-hasura-user-id": 1
}
```

Then, the GraphQL request will be executed as the `user` role, instead of the `admin` role and the session variables
from the HTTP request headers will be considered. So, in this case, the value of the session variable `x-hasura-user-id`
will be 2, instead of 1.

### Unsuccessful role emulation

If the webhook response were the following:

```json
{
  "x-hasura-role": "author",
  "x-hasura-user-id": 1
}
```

Then, the GraphQL query will be executed as the `author` role and **only** the session variables from the authentication
webhook response will be considered. So, in this case, the value of the session variable `x-hasura-user-id` will be 1.
