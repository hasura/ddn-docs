---
sidebar_position: 4
sidebar_label: Stored Procedures
description:
  "Stored Procedures allow you to encapsulate logic in your SQL Server database. This page explains how to configure
  Stored Procedures in Hasura."
keywords:
  - stored procedures
seoFrontMatterUpdated: false
---

# Stored Procedures

## Introduction

Stored Procedures allow you to encapsulate logic in your SQL Server database. This page explains how to configure
Stored Procedures in Hasura.

## Create a Stored Procedure

To create a new Native Query, use the `ddn` CLI to add it to the connector configuration:

1. The stored procedures present in the database can be added by running the following command:

   ```sh
   $ ddn connector plugin --connector my_subgraph/connector/chinook_sqlserver/connector.yaml -- update stored-procedures
   ```

2. Update your metadata to track the new native query:

   ```sh
   $ ddn connector-link update chinook_sqlserver --add-all-resources
   ```

After running the above command, the stored procedures will appear in the `$.metadata.storedProcedures` key of the
configuration.

## Overwite the existing Stored Procedure

To overwrite an existing Stored Procedure, use `ddn` CLI to update it to the connector configuration:

   ```sh
   $ ddn connector plugin --connector app/sqlserver/connector.yaml -- update stored-procedures --overwrite
   ```

:::note

The stored procedure generated by the introspection contains `returns` as `null` because a stored procedure can return
multiple result sets or output parameters, so it is not possible for the connector to automatically determine the return
type of the stored procedure. You should manually update the stored procedure's configuration to include the return type
of the stored procedure, as shown below.

The return type of a stored procedure should include the fields that are going to be returned by the stored procedure.
The fields should be defined in the `returns` key of the stored procedure configuration.

For example, if the stored procedure returns `CustomerId`, `Phone` and `TotalPurchases`, we can add a return type for
it, as following:

```json

{
  "storedProcedures": {
    "GetArtistsByName": {
      "name": "GetArtistsByName",
      "schema": "dbo",
      "arguments": {
        "Name": {
          "name": "Name",
          "type": "varchar",
          "nullable": "nullable",
          "isOutput": false,
          "description": null
        }
      },
      "returns": {
        "CustomerId": {
          "name": "CustomerId",
          "type": "int",
          "nullable": "nonNullable",
          "description": null
        },
        "Phone": {
          "name": "Phone",
          "type": "varchar",
          "nullable": "nonNullable",
          "description": null
        },
        "TotalPurchases": {
          "name": "TotalPurchases",
          "type": "int",
          "nullable": "nonNullable",
          "description": null
        }
      },
      "description": null
    }
  }
}

```

:::
