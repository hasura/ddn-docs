---
sidebar_position: 2.5
sidebar_label: Context and Environments
---

# Context and Environments

You can use the context feature in the DDN CLI to set pre-defined variables for your project so that you can enable the
deployment to multiple environments and avoid passing them as specific flags in each command.

## Context

You can create multiple contexts in your `context.yaml` file. Each context can have a different set of variables for:

- `supergraph`
- `subgraph`
- `localEnvFile`
- `cloudEnvFile`
- `selfHostedDataPlane`
- `project`

You can then switch between contexts easily using the `ddn context set-current-context <context-name>` command.

You can read more about the context commands in the [DDN CLI reference](/cli/commands/ddn_context.mdx).

### Create Context

```sh title="Create a new context"
ddn context create-context staging
```

This will create a new context in the `./hasura/context.yaml` file and make it the current context. The current context
is also defined in the `context.yaml` file.

### Setting a variable in a context

```sh title="Set a variable in a context"
ddn context set project normal-kangaroo-2890
```

You can also specify the context to use in the command:

```sh title="Set a variable in a context"
ddn context set project normal-kangaroo-2890 --context staging
```

### Switching Context

```sh title="Switch to a different context"
ddn context set-current-context production
```

### Listing the variables in a context

```sh title="List the variables in a context"
ddn context get-context production
```

### Output the value of a variable

```sh title="Output the value of a specific variable in the current context"
ddn context get project
```

You can also specify the context to use in the command:

```sh title="Output the value of a specific variable in a specific context"
ddn context get project --context staging
```

:::info Output format

As always you can specify how to output the result (table, json, yaml) with the `--out` flag.

:::

### Example context

The following is an example of a context file located in the ./hasura/context.yaml file. Since the context is in plain
text and is the source of truth for your project, you are also able to edit it directly.

```yaml
kind: Context
version: v3
definition:
  current: development
  contexts:
    development:
      project: simple-mouse-3265
      supergraph: ../supergraph-development.yaml
      subgraph: ../my_subgraph/subgraph.yaml
      localEnvFile: ../.env
      cloudEnvFile: ../.env.cloud
    staging:
      project: normal-kangaroo-2890
      supergraph: ../supergraph.yaml
      cloudEnvFile: ../.env.cloud.staging
    production:
      project: proper-whale-2870
      supergraph: ../supergraph.yaml
      cloudEnvFile: ../.env.cloud.prod
  scripts:
    docker-start:
      bash:
        HASURA_DDN_PAT=$(ddn auth print-pat) PROMPTQL_SECRET_KEY=$(ddn auth print-promptql-secret-key) docker compose -f
        compose.yaml --env-file .env up --build --pull always
      powershell:
        $Env:HASURA_DDN_PAT = ddn auth print-pat; $Env:PROMPTQL_SECRET_KEY = ddn auth print-promptql-secret-key; docker
        compose -f compose.yaml --env-file .env up --build --pull always
  promptQL: false
```

## Alternative configuration files per environment

You can also specify different configuration files per environment. This is useful if you want to use different setups
for each.

For example, if in `development` you want to use `noAuth` mode but for `staging` and `production` you want to use JWT
mode, you can create a supergraph config file for each environment and then specify the correct file in the context.

In the following example we have a `supergraph-development.yaml` file which specifies a chain to the
`subgraph-development.yaml` to the `metadata_development` directory to include for the metadata which sets the `noAuth`
mode for development context.

```yaml title="supergraph-development.yaml"
kind: Supergraph
version: v2
definition:
  subgraphs:
    # highlight-start
    - globals/subgraph-development.yaml
    # highlight-end
    - my_subgraph/subgraph.yaml
```

```yaml title="globals/subgraph-development.yaml"
kind: Subgraph
version: v2
definition:
  name: globals
  generator:
    rootPath: .
  # highlight-start
  includePaths:
    - metadata_development
  # highlight-end
```

```yaml title="globals/metadata_development/auth-config.hml"
kind: AuthConfig
version: v2
definition:
  mode:
    noAuth:
      role: admin
      sessionVariables: {}
```

Then similarly, we would have the supergraph file for the other environments to use which specifies JWT mode in the
`auth-config.yaml` file. You can read more about [auth here](/auth/overview.mdx).
