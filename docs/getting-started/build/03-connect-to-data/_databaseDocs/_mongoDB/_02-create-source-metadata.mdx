## What's about to happen

Now that we have a JSON configuration, which represents the collections in MongoDB, we can now use it to generate Hasura
metadata.

## Step 1. Create the Hasura metadata

:::tip Required

- [The DDN CLI, VS Code extension, and Docker installed](/getting-started/prerequisites)
- A new or existing [supergraph](/getting-started/init-supergraph)
- A new or existing [subgraph](/getting-started/init-subgraph)
- A [MongoDB connector](/getting-started/03-connect-to-data/connect-a-source) initialized and introspected

:::

Hasura DDN uses a concept called "connector linking" to take configuration JSON files for a data connector and
transform them into an `hml` (Hasura Metadata Language) file as a
[`DataConnectorLink`](/supergraph-modeling/data-connector-links/) metadata object which describes our data source.

Let's add and name the `hml` file the same as our connector, `my_pg`:

```bash title="Run the following from the root of your project:"
ddn connector-link add my_mongo \
  --subgraph my_subgraph/subgraph.yaml \
  --configure-host http://local.hasura.dev:8082 \
  --target-env-file my_subgraph/.env.my_subgraph.local
```

The new file is scaffolded out at `my_subgraph/metadata/my_mongo.hml`.

:::info JSON and HML, why both?

Basically, metadata objects in `hml` files contain the data connector schema in a
[format](https://github.com/hasura/ndc-spec) which is generic for all connectors. The JSON on the other hand contains a
format specific to that connector. It does not need to be JSON, it could just as easily be SQL files, TypeScript
functions, or anything else. It's just a representation that the specific connector understands.

:::

<details>
  <summary>Click here for an example `hml` `DataConnectorLink` file</summary>

```yaml
kind: DataConnectorLink
version: v1
definition:
name: my_mongo
url:
  readWriteUrls:
    read:
      valueFromEnv: MY_SUBGRAPH_MY_MONGO_READ_URL
    write:
      valueFromEnv: MY_SUBGRAPH_MY_MONGO_WRITE_URL
schema:
  version: v0.1
  schema:
    scalar_types: {}
    object_types: {}
    collections: []
    functions: []
    procedures: []
  capabilities:
    version: ""
    capabilities:
      query: {}
      mutation: {}
```

</details>

The generated file has two environment variables â€” one for reads and one for writes. Because we used the convenience
flag: `--configure-host` on the command, these values are already set in the `.env.my_subgraph.local` file:

```env
MY_SUBGRAPH_MY_MONGO_READ_URL="http://local.hasura.dev:8082"
MY_SUBGRAPH_MY_MONGO_WRITE_URL="http://local.hasura.dev:8082"
```

These values are for the MongoDB connector itself and utilize `local.hasura.dev` to ensure proper resolution within the
docker container.

## Step 2. Start the services

Let's start our docker compose services if they are not already running.

```bash title="From the root of your project, run:"
HASURA_DDN_PAT=$(ddn auth print-pat) docker compose up --build --watch
```

This starts our Hasura Engine, observability tools and the MongoDB connector all together since we added the connector's
Docker compose file to the main `compose.yaml` file using the `--add-to-compose-file` flag when we
initialized the connector. `HASURA_DDN_PAT=$(ddn auth print-pat)` gives the Hasura Engine access to the DDN CLI's
authentication token.

We can navigate to the following address, with the port modified, to see the schema of our MongoDB database:

```text
http://localhost:8082/schema
```

## Step 3. Update the new DataConnectorLink object with metadata for your MongoDB database

Finally, now that our `DataConnectorLink` has the correct environment variables configured for the MongoDB connector, we
can run the `update` command to have the CLI look at the configuration JSON and transform it to reflect our database's
schema in `hml` format:

```bash
ddn connector-link update my_mongo \
  --subgraph my_subgraph/subgraph.yaml \
  --env-file my_subgraph/.env.my_subgraph.local
```

After this command runs, you can open the same `my_subgraph/metadata/my_mongo/my_mongo.hml` file and see your metadata
completely scaffolded out for you ðŸŽ‰

<details>
  <summary>Click here for an example `hml` `DataConnectorLink` file with metadata (abridged)</summary>

```yaml
kind: DataConnectorLink
version: v1
definition:
name: my_mongo
url:
  readWriteUrls:
    read:
      valueFromEnv: MY_SUBGRAPH_MY_MONGO_READ_URL
    write:
      valueFromEnv: MY_SUBGRAPH_MY_MONGO_WRITE_URL
schema:
  version: v0.1
  schema:
    scalar_types:
      BinData:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: BinData
      Bool:
        representation:
          type: boolean
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: Bool
      Date:
        representation:
          type: timestamp
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: Date
          min:
            result_type:
              type: named
              name: Date
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: Date
          _gte:
            type: custom
            argument_type:
              type: named
              name: Date
          _lt:
            type: custom
            argument_type:
              type: named
              name: Date
          _lte:
            type: custom
            argument_type:
              type: named
              name: Date
          _neq:
            type: custom
            argument_type:
              type: named
              name: Date
      DbPointer:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: DbPointer
      Decimal:
        representation:
          type: bigdecimal
        aggregate_functions:
          avg:
            result_type:
              type: named
              name: Decimal
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: Decimal
          min:
            result_type:
              type: named
              name: Decimal
          sum:
            result_type:
              type: named
              name: Decimal
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: Decimal
          _gte:
            type: custom
            argument_type:
              type: named
              name: Decimal
          _lt:
            type: custom
            argument_type:
              type: named
              name: Decimal
          _lte:
            type: custom
            argument_type:
              type: named
              name: Decimal
          _neq:
            type: custom
            argument_type:
              type: named
              name: Decimal
      Double:
        representation:
          type: float64
        aggregate_functions:
          avg:
            result_type:
              type: named
              name: Double
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: Double
          min:
            result_type:
              type: named
              name: Double
          sum:
            result_type:
              type: named
              name: Double
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: Double
          _gte:
            type: custom
            argument_type:
              type: named
              name: Double
          _lt:
            type: custom
            argument_type:
              type: named
              name: Double
          _lte:
            type: custom
            argument_type:
              type: named
              name: Double
          _neq:
            type: custom
            argument_type:
              type: named
              name: Double
      ExtendedJSON:
        representation:
          type: json
        aggregate_functions: {}
        comparison_operators: {}
      Int:
        representation:
          type: int32
        aggregate_functions:
          avg:
            result_type:
              type: named
              name: Int
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: Int
          min:
            result_type:
              type: named
              name: Int
          sum:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: Int
          _gte:
            type: custom
            argument_type:
              type: named
              name: Int
          _lt:
            type: custom
            argument_type:
              type: named
              name: Int
          _lte:
            type: custom
            argument_type:
              type: named
              name: Int
          _neq:
            type: custom
            argument_type:
              type: named
              name: Int
      Javascript:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators: {}
      JavascriptWithScope:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators: {}
      Long:
        representation:
          type: int64
        aggregate_functions:
          avg:
            result_type:
              type: named
              name: Long
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: Long
          min:
            result_type:
              type: named
              name: Long
          sum:
            result_type:
              type: named
              name: Long
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: Long
          _gte:
            type: custom
            argument_type:
              type: named
              name: Long
          _lt:
            type: custom
            argument_type:
              type: named
              name: Long
          _lte:
            type: custom
            argument_type:
              type: named
              name: Long
          _neq:
            type: custom
            argument_type:
              type: named
              name: Long
      MaxKey:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: MaxKey
      MinKey:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: MinKey
      "Null":
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: "Null"
      ObjectId:
        representation:
          type: string
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: ObjectId
      Regex:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators: {}
      String:
        representation:
          type: string
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: String
          min:
            result_type:
              type: named
              name: String
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: String
          _gte:
            type: custom
            argument_type:
              type: named
              name: String
          _iregex:
            type: custom
            argument_type:
              type: named
              name: String
          _lt:
            type: custom
            argument_type:
              type: named
              name: String
          _lte:
            type: custom
            argument_type:
              type: named
              name: String
          _neq:
            type: custom
            argument_type:
              type: named
              name: String
          _regex:
            type: custom
            argument_type:
              type: named
              name: String
      Symbol:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: Symbol
      Timestamp:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
          max:
            result_type:
              type: named
              name: Timestamp
          min:
            result_type:
              type: named
              name: Timestamp
        comparison_operators:
          _eq:
            type: equal
          _gt:
            type: custom
            argument_type:
              type: named
              name: Timestamp
          _gte:
            type: custom
            argument_type:
              type: named
              name: Timestamp
          _lt:
            type: custom
            argument_type:
              type: named
              name: Timestamp
          _lte:
            type: custom
            argument_type:
              type: named
              name: Timestamp
          _neq:
            type: custom
            argument_type:
              type: named
              name: Timestamp
      Undefined:
        aggregate_functions:
          count:
            result_type:
              type: named
              name: Int
        comparison_operators:
          _eq:
            type: equal
          _neq:
            type: custom
            argument_type:
              type: named
              name: Undefined
    object_types:
      movies:
        fields:
          _id:
            type:
              type: nullable
              underlying_type:
                type: named
                name: ObjectId
          awards:
            type:
              type: nullable
              underlying_type:
                type: named
                name: movies_awards
          cast:
            type:
              type: nullable
              underlying_type:
                type: array
                element_type:
                  type: named
                  name: String
          countries:
            type:
              type: nullable
              underlying_type:
                type: array
                element_type:
                  type: named
                  name: String
          directors:
            type:
              type: nullable
              underlying_type:
                type: array
                element_type:
                  type: named
                  name: String
          fullplot:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          genres:
            type:
              type: nullable
              underlying_type:
                type: array
                element_type:
                  type: named
                  name: String
          imdb:
            type:
              type: nullable
              underlying_type:
                type: named
                name: movies_imdb
          languages:
            type:
              type: nullable
              underlying_type:
                type: array
                element_type:
                  type: named
                  name: String
          lastupdated:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          metacritic:
            type:
              type: nullable
              underlying_type:
                type: named
                name: Int
          num_mflix_comments:
            type:
              type: nullable
              underlying_type:
                type: named
                name: Int
          plot:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          poster:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          rated:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          released:
            type:
              type: nullable
              underlying_type:
                type: named
                name: Date
          runtime:
            type:
              type: nullable
              underlying_type:
                type: named
                name: Int
          title:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          tomatoes:
            type:
              type: nullable
              underlying_type:
                type: named
                name: movies_tomatoes
          type:
            type:
              type: nullable
              underlying_type:
                type: named
                name: String
          writers:
            type:
              type: nullable
              underlying_type:
                type: array
                element_type:
                  type: named
                  name: String
          year:
            type:
              type: nullable
              underlying_type:
                type: named
                name: ExtendedJSON
    collections:
      - name: movies
        arguments: {}
        type: movies
        uniqueness_constraints: {}
        foreign_keys: {}
    functions: []
    procedures: []
  capabilities:
    version: 0.1.2
    capabilities:
      query:
        aggregates: {}
        variables: {}
        explain: {}
      mutation: {}
      relationships: {}
```

</details>

## What did this do?

By creating a `my_mongo.hml` file, we've provided Hasura with a link between our original data source and the types
which we'll eventually expose via our API.

## Next steps

With a data connector fully configured, you can now start to create metadata for each table and view in your MongoDB
database using `hml`. Learn how to do this by
[adding source entities](/getting-started/build/connect-to-data/add-source-entities).
