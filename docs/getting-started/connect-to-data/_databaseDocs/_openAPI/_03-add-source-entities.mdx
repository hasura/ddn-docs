import BaseUrlLink from '@site/src/components/databaseDocs/baseLink';

## What's about to happen?

Endpoints your OpenAPI document are exposed to your API via [commands](/supergraph-modeling/commands).

You can use the CLI to generate an `hml` file which will describe a command and any other supporting objects, allowing
you to easily and declaratively customize authorization rules, create relationships, or deprecate certain fields.

:::tip Required

<!-- prettier-ignore -->
- <BaseUrlLink to="/getting-started/prerequisites" text="The DDN CLI, VS Code extension, and Docker installed" />
- A new or existing <BaseUrlLink to="/getting-started/init-supergraph" text="supergraph" />
- A new or existing <BaseUrlLink to="/getting-started/init-subgraph" text="subgraph" />

:::

## Add a command

<!-- prettier-ignore -->
Hasura DDN works by deploying your API as immutable builds, similar to git commits, based on changes to your project's
metadata. This frees you to iteratively and rapidly test incremental changes to your API without causing disruption
to other collaborators or downstream consumers. Before we create a supergraph build, let's first add a
[command](supergraph-modeling/commands/) to our subgraph.

Along with [models](supergraph-modeling/models/), commands serve as the link between your data connector and the
API Hasura generates. For OpenAPI documents, commands correspond to API endpoints.

If you look in your `my_subgraph/connector/my_openapi/connector/my_openapi.hml` file, you'll see `functions` and
`procedures` for each endpoint in your OpenAPI document. For each of these, you can run the following to create a
command for them:

```bash
ddn command add --connector-link my_openapi --name <function_or_procedure>
```

:::tip Casing matters

When adding a command, it is critical to use the same casing as the `function` or `procedure` from your connector's
schema definition file.

:::

:::info Functions vs Procedures

[Functions](/glossary/#function) are used for read operations without side-effects, while
[procedures](/glossary/#procedure) are used for write operations with side-effects. Tracking of either of these will
result in the creation of a [Command](/glossary/#command) in your subgraph.

:::

<details>
  <summary>
    Each time you add a command, you'll see a new named file in the `metadata` directory of your subgraph. For example,
    if we ran the previous command on the `getUserLoginUser` function, we'd then see a `GetUserLoginUser.hml` file that contains
    all the metadata Hasura DDN needs to add it to our API. Click here to see an example `hml` file.
  </summary>

```yaml
# GetUserLoginUser.hml
---
kind: ObjectType
version: v1
definition:
  name: GetUserLoginUserQuery
  fields:
    - name: password
      type: String
      description: The password for login in clear text
    - name: username
      type: String
      description: The user name for login
  graphql:
    typeName: MySubgraph_GetUserLoginUserQuery
    inputTypeName: MySubgraph_GetUserLoginUserQueryInput
  dataConnectorTypeMapping:
    - dataConnectorName: my_openapi
      dataConnectorObjectType: getUserLoginUser_query

---
kind: TypePermissions
version: v1
definition:
  typeName: GetUserLoginUserQuery
  permissions:
    - role: admin
      output:
        allowedFields:
          - password
          - username

---
kind: Command
version: v1
definition:
  name: GetUserLoginUser
  outputType: String!
  arguments:
    - name: headers
      type: Json
    - name: query
      type: GetUserLoginUserQuery!
  source:
    dataConnectorName: my_openapi
    dataConnectorCommand:
      function: getUserLoginUser
  graphql:
    rootFieldName: mySubgraph_getUserLoginUser
    rootFieldKind: Query
  description: Logs user into the system

---
kind: CommandPermissions
version: v1
definition:
  commandName: GetUserLoginUser
  permissions:
    - role: admin
      allowExecution: true


```

</details>

## Next steps

:::tip Ready to import _all_ your endpoints?

You can do this in one convenience command:

```bash
ddn connector-link update my_openapi --subgraph my_subgraph --add-all-resources
```

:::

<!-- prettier-ignore -->
This model can now be used to <BaseUrlLink to="/getting-started/build-your-api" text="query data via your API" />. You
can also customize the model by adding <BaseUrlLink to="/getting-started/add-permissions" text="access control rules"/>,

<BaseUrlLink to="/getting-started/create-a-relationship" text="creating relationships" /> to other entities, or deprecating
certain fields.

