---
sidebar_position: 2
sidebar_label: Quickstart
description:
  "Explore the Engine Plugins. Understand how they can be used to add new functionalities on top of the Hasura DDN"
keywords:
  - hasura plugins
  - plugins
  - engine plugins
  - custom execution
  - Quick start plugin
seoFrontMatterUpdated: false
---

# Quickstart

## Introduction

For this quickstart, we'll use the [allowlist plugin](https://github.com/hasura/plugin-allowlist). This adds an
allowlist layer on top of your supergraph to restrict access to only specific queries or mutations.

:::info We're using Cloudflare Wrangler

In this example, we're using Cloudflare Wrangler to deploy our plugin as a Cloudflare Worker. However, you can use any
other tool or service that hosts HTTPS services you wish. You can get started with Wrangler
[here](https://developers.cloudflare.com/workers/wrangler/install-and-update/).

:::

## Step 1. Create a new Wrangler project

Create a Wrangler project with the `allowlist` plugin template.

```bash
wrangler generate allowlist-plugin https://github.com/hasura/plugin-allowlist
```

This will create a new local Wranlger project using the allowlist plugin as a template in your current directory.

## Step 2. Configure the plugin

In the new directory, update the `wrangler.toml` file with the required configurations.

```toml
...
[vars]
OTEL_EXPORTER_OTLP_ENDPOINT = "https://gateway.otlp.hasura.io:443/v1/traces"
OTEL_EXPORTER_PAT = "<PAT>"
```

Replace `<PAT>` with the Personal Access Token (PAT) for the Hasura Cloud account. You can generate this using the
`ddn auth print-pat` command.

## Step 3. Update the config

Update the `src/config.ts` file with the queries and mutations that you want to allow, using a strong m-auth key.

```typescript
export const Config = {
    headers: {
    "hasura-m-auth": "your-strong-m-auth-key",
    },
    allowlist: [
    ...,
    "query MyQuery {\n  getAuthorById(author_id: 10) {\n    first_name\n    id\n    last_name\n  }\n}",
    ],
};
```

## Step 4. Add the hosted plugin

We'll let the engine know about the plugin and to execute it as a pre-parse plugin by creating a new metadata file. In
your `global` subgraph's metadata directory, create a new file named `allow-list.hml` and add the following
configuration.

```yaml
kind: LifecyclePluginHook
version: v1
definition:
name: cloudflare allow list
url:
  valueFromEnv: ALLOW_LIST_URL
pre: parse
config:
  request:
    headers:
      additional:
      hasura-m-auth:
        valueFromEnv: M_AUTH_KEY
    session: {}
    rawRequest:
      query: {}
      variables: {}
```

:::info Using environment variables

We've used `valueFromEnv` so that we can dynamically and securely add values from our environment variables. You can add
these values to your root-level `.env` and then map them in the `globals` subgraph.yaml file. Alternatively, you can
include raw strings here using `value` instead of `valueFromEnv` and passing the keys.

:::

## Step 5. Test the plugin locally

You can run the plugin locally and test it:

```bash
npm start
```

The plugin will be available at `http://localhost:8787`.

:::info Testing local development

You can test the local development by adding the local development endpoint (obtained in step 5) in your
LifeCyclePluginHook metadata file.

:::

## Step 6. Deploy the plugin

For your plugin to be reachable by your hosted supergraph, we'll need to deploy using Cloudflare Wrangler. The `deploy`
command included in your plugin's `package.json` will do this automatically for you and return the hoted service's URL.

**Note**: Please also update the `wrangler.toml` with your cloud PAT for the tracing to work.

```bash
npm run deploy
```

## Step 7. Create a new build

Create a new supergraph build.

```bash
ddn supergraph build
```

The engine will execute the plugin before each request using the queries or mutations you defined.
